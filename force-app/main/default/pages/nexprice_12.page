<apex:page id="thepage" controller="Nexprice" sidebar="false" >
<meta http-equiv="X-UA-Compatible" content="chrome=1"/>
<script src="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/js/jquery-1.8.3.min.js')}" type="text/javascript"/> 
<script src="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/js/jquery-ui-1.9.2.custom.js')}" type="text/javascript"/>
<script src="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/js/jquery.mobile.events.js')}" type="text/javascript"/>
<script src="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/js/jquery.dataTables.js')}" type="text/javascript"/>
<script src="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/js/jquery.dataTables.columnFilter.js')}" type="text/javascript"></script>
<script src="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/js/jquery-ui.toggleSwitch.js')}" type="text/javascript"/>
<script src="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/js/jquery.sortElements.js')}" type="text/javascript"></script>
<script src="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/js/jquery.dataTables.extensions.js')}" type="text/javascript"></script>
<script src="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/js/jquery.tooltip.js')}" type="text/javascript"></script>
<script src="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/js/jquery.multiselect.min.js')}" type="text/javascript"/> 
<script src="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/js/jquery.multiselect.filter.js')}" type="text/javascript"/>
<script src="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/js/jquery.validate.js')}" type="text/javascript"/>
<script src="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/js/jquery.form.js')}" type="text/javascript"/>
<script src="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/js/jquery.bbq.js')}" type="tgetext/javascript"/>
<script src="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/js/jquery.form.wizard.js')}" type="text/javascript"/>
<script src="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/js/jquery.easyui.min.js')}" type="text/javascript"></script>
<script src="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/js/FixedHeader.js')}" type="text/javascript"></script>

<apex:stylesheet value="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/themes/default/easyui.css')}"/>  
<apex:stylesheet value="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/css/jquery.tooltip.css')}"/>
<apex:stylesheet value="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/css/start/jquery-ui-1.10.1.custom.min.css')}"/>
<apex:stylesheet value="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/css/demo_table.css')}"/> 
<apex:stylesheet value="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/themes/default/easyui.css')}"/>    
<apex:stylesheet value="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/themes/icon.css')}"/> 
<apex:stylesheet value="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/themes/default/menu.css')}"/>
<apex:stylesheet value="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/themes/default/menubutton.css')}"/>
<apex:stylesheet value="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/themes/default/splitbutton.css')}"/>
<apex:stylesheet value="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/themes/icon.css')}"/>
<apex:stylesheet value="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/css/jquery-ui.toggleSwitch.css')}"/> 
<apex:stylesheet value="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/css/jquery.multiselect.css')}"/> 
<apex:stylesheet value="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/css/jquery.multiselect.filter.css')}"/> 
<script type="text/javascript">
    var __sfdcSessionId = '{!GETSESSIONID()}';
</script>

<script  src="/soap/ajax/25.0/connection.js" type="text/javascript"></script>
<script  src="/soap/ajax/25.0/apex.js" type="text/javascript"></script>

<script type="text/javascript" charset="utf-8">

var aRecordIds = new Array();
var aColumnIndex = new Array();
var aColumnIndex_Draft = new Array();
var aSel = new Array();
var iProcessing = 0;
var iLimit = {!$Setup.nexPrice_Settings__c.Salesforce_Record_Limit__c};
var sPrevAccount = '';
var timeout;
var saveflag = 'True';
var flagcheck;
var CMflag = false;


$(document).ready(function() { 
  fnLoadcounter();
  fnInitPage();
  
  fnInitTable();
  fnEvaluateTable($('#price_maintenance' ).dataTable());
  fnInitViewTables();
  fnPrepFilters('price_maintenance', aColumnIndex);
  fnPrepFilters('quotetable', aColumnIndex_Draft);
  
  fnPrepFilters('audittable', aColumnIndex_Draft);
  fnPrepFilters('pendingtable', aColumnIndex_Draft);
  fnPrepFilters('rejectalternate', aColumnIndex_Draft);
  fnShowFog();
  fnInitAddMaterial();
  fnrfq();
  
  var listID;
  
  if('{!$CurrentPage.parameters.id}' == '')
    fnHideFog();
 
  
});

function fnInitViewTables(){
$('.viewtable').dataTable({
                "aLengthMenu": [[100, 250, 500, 750], [100, 250, 500, 750]],
                "iDisplayLength": 100,
                "bDestroy": true,
                "fnDrawCallback": function( oSettings ) {
                   $('.row_selected').removeClass('row_selected');
                 },
                "bSort": true,
                "sErrMode": false,
                "sDom": 'lfrtip',
                "bJQueryUI": true,
                "sPaginationType": "four_button",
                "aoColumnDefs":[
                    
                    { "aTargets":[ "Open"], bSortable:"false", sClass:"Open" ,sWidth:"2px", "bAutoWidth": false},
                    { "aTargets":[ "Select"], sClass:"Select", sWidth:"2px", "bAutoWidth": false },
                    { "aTargets":[ "Approval_Status" ], "mData": "Approval_Status__c", sClass:"Approval_Status__c",sWidth:"2px", "bAutoWidth": false },
                    { "aTargets":[ "Approval_Level" ], "mData": "Approval_Level__c", sClass:"Approval_Level__c",sWidth:"2px", "bAutoWidth": false },
                    { "aTargets":[ "Approver" ], "mData": "Approver__r.Name", sClass:"Approver__r.Name",sWidth:"2px", "bAutoWidth": false },
                    { "aTargets":[ "Type" ], "mData": "Type__c", sClass:"Type__c",sWidth:"2px", "bAutoWidth": false },
                    { "aTargets":[ "Sold_To" ], "mData": "SAP_SoldTo_Account__c", sClass:"SAP_SoldTo_Account__c",sWidth:"2px", "bAutoWidth": false},
                    { "aTargets":[ "Ship_To" ], "mData": "SAP_ShipTo_Account__c", sClass:"SAP_ShipTo_Account__c",sWidth:"2px", "bAutoWidth": false },
                    { "aTargets":[ "Material" ], "mData": "Material__c", sClass:"Material__c",sWidth:"2px", "bAutoWidth": false },
                    { "aTargets":[ "Eff_Date" ], sClass:"Requested_Effective_Date__c",sWidth:"2px", "bAutoWidth": false,
                      "mData": function ( source, type, val ) {
                          if (type === 'set') {
                              return;
                          }
                          else if (type === 'display') { 
                              if (source.Requested_Effective_Date__c != '' && source.Requested_Effective_Date__c != null){
                                 var ReqDate = new Date(source.Requested_Effective_Date__c);
                                 if('{!DateFormat}' == 'mm/dd/yy')
                                    return (ReqDate.getUTCMonth()+1) + "/" + ReqDate.getUTCDate() + "/" + ReqDate.getUTCFullYear();
                                 else
                                    return ReqDate.getUTCDate() + "/" + (ReqDate.getUTCMonth()+1) + "/" + ReqDate.getUTCFullYear(); 
                              }                                
                              else return '';}
                          else if (type === 'filter') {  return source.Requested_Effective_Date__c; }
                          else if (type === 'sort') { 
                           if((typeof source.Requested_Effective_Date__c == 'undefined') || source.Requested_Effective_Date__c == null)
                              return '';
                            else 
                             return new Date(source.Requested_Effective_Date__c);
                          }
                          return source.Requested_Effective_Date__c;
                      }
                    },
                    { "aTargets":[ "Exp_Date" ], sClass:"Requested_Expiration_Date__c",sWidth:"2px", "bAutoWidth": false,
                      "mData": function ( source, type, val ) {
                          if (type === 'set') {
                              return;
                          }
                          else if (type === 'display') { 
                          if (source.Requested_Expiration_Date__c != '' && source.Requested_Expiration_Date__c != null){
                             var ReqexpDate = new Date(source.Requested_Expiration_Date__c);
                             if('{!DateFormat}' == 'mm/dd/yy')
                                    return (ReqexpDate.getUTCMonth()+1) + "/" + ReqexpDate.getUTCDate() + "/" + ReqexpDate.getUTCFullYear();
                                 else
                                    return ReqexpDate.getUTCDate() + "/" + (ReqexpDate.getUTCMonth()+1) + "/" + ReqexpDate.getUTCFullYear();
                             }                                 
                          else return '';}
                          else if (type === 'filter') {  return source.Requested_Expiration_Date__c; }
                          else if (type === 'sort') { 
                           if((typeof source.Requested_Expiration_Date__c == 'undefined') || source.Requested_Expiration_Date__c == null)
                              return '';
                            else 
                             return new Date(source.Requested_Expiration_Date__c);
                          }
                          return source.Requested_Expiration_Date__c;
                      }
                    },
                    { "aTargets":[ "Volume" ], "mData": "Volume__c", sClass:"Volume__c",sWidth:"2px", "bAutoWidth": false },
                    { "aTargets":[ "Requested_UoM" ], "mData": "Requested_UoM__c", sClass:"Requested_UoM__c",sWidth:"2px", "bAutoWidth": false },
                    { "aTargets":[ "Price" ],  sClass:"Price__c",sWidth:"2px", "bAutoWidth": false,
                    "mData": function ( source, type, val ) {
                          if (type === 'set') {
                              return;
                          }
                          else if (type === 'display' || type == 'sort' || type == 'filter') { 
                             if(source.Price__c == '' || source.Price__c == null || typeof source.Price__c == 'undefined')
                               return;
                             else
                             return source.Price__c.toFixed(4);
                          }
                          return source.Price__c;
                      }
                    
                     },
                    { "aTargets":[ "Requested_Price_UoM" ], "mData": "Requested_Price_UoM__c", sClass:"Requested_Price_UoM__c",sWidth:"2px", "bAutoWidth": false },
                    { "aTargets":[ "TPI" ], sClass:"TPI__c",sWidth:"2px", "bAutoWidth": false,
                      "mData": function ( source, type, val ) {
                          if (type === 'set') {
                              return;
                          }
                          else if (type === 'display') { 
                            if((typeof source.TPI__c == 'undefined') || source.TPI__c == null)
                              return '';
                            else 
                              return (source.TPI__c + '%');
                          }
                          else if (type === 'filter') {  return source.TPI__c; }
                          else if (type === 'sort') { return source.TPI__c; }
                          return source.TPI__c;
                      }
                    },
                    { "aTargets":[ "Comments" ], "mData": "Comments__c", sClass:"Comments__c",sWidth:"2px", "bAutoWidth": false },
                    { "aTargets":[ "Approval_Rejection_Comments" ], "mData": "Approval_Rejection_Comments__c", sClass:"Approval_Rejection_Comments__c",sWidth:"2px", "bAutoWidth": false },
                    { "aTargets":[ "Transaction" ], "mData": "Name", sClass:"Name",sWidth:"2px", "bAutoWidth": false},
                    { "aTargets":[ "Id" ],"mData": "Id", sClass:"Id",sWidth:"2px", "bAutoWidth": false, "bVisible":false},
                    { "aTargets":[ "Inner_Table" ],"mData": "Inner_Table__c", sClass:"Inner_Table__c",sWidth:"2px", "bAutoWidth": false, "bVisible":false},
                    { "aTargets":[ "Prospect_Material" ],"mData": "Prospect_Material__c", sClass:"Prospect_Material__c",sWidth:"2px", "bAutoWidth": false, "bVisible":false},
                    { "aTargets":[ "Accountid" ],"mData": "Account_Material__r.Account__c", sClass:"Account_Material__r.Account__c",sWidth:"2px", "bAutoWidth": false, "bVisible":false},
                                   
                  ],                  
                 "fnInitComplete": function(oSettings) {
                     aColumnIndex_Draft = fnGetColumnIndex(oSettings);
                  },  
                "fnCreatedRow": function( nRow, aData, iDataIndex ) {
                    $('td:eq(0)', nRow).html( '<img class="details_img" src="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/images/details_open.png')}">');
                    if($(this).dataTable().fnSettings().sTableId == 'quotetable')
                    {
                        if(aData.Approval_Status__c == 'Rejected' || aData.Approval_Status__c == 'Submitted' || aData.Approval_Status__c == 'Rejected-Alternate' || aData.Approval_Status__c == 'Rejected By Approver')
                        $('td:eq(1)', nRow).html( '<input type="checkbox" name="SelectedAudit" class="SelectedAudit" value="'+ aData.Id+'" disabled="disabled">');
                        else
                        $('td:eq(1)', nRow).html( '<input type="checkbox" name="SelectedAudit" class="SelectedAudit" value="'+ aData.Id+'">');
                    }
                     if($(this).dataTable().fnSettings().sTableId == 'rejectalternate')
                       $('td:eq(1)', nRow).html( '<input type="checkbox" name="SelectedAudit" class="SelectedAudit" value="'+ aData.Id+'">');
                    
                    fnSetImgListener(nRow, $(this).dataTable().fnSettings().sTableId);
                    fnSetCheckboxListener(nRow, $(this).dataTable());
                 } 
                
                    
              })

    
}

function fnAddRowCSP(){

  var count = $('.bracketcontainer').size();
  var countnext = $('.bracketcontainernext').size();
 
 
 var newRow = '<tr class="bracketcontainernext" id="bracketcontainernextid_'+ (count)+ '" style="height:10px;"><td style="vertical-align:top;padding-right:1px;">';
      newRow += '<input class="bracketvolume combo required number" name="bracketvolumenext_'+ (count)+ '" style="width:100px;height:20px;" />';
      newRow += '<br/><div class="error_container"/></td><td></td><td style="vertical-align:top;padding-right:1px;"><input class="bracketprice combo required currency" name="bracketpricenext_'+ (count)+ '" style="height:20px;"/>';
      newRow += '<br/><div class="error_container"/></td></tr>';
  
   var newRowAdd = '<tr class="bracketcontainer" style="height:10px;"><td style="vertical-align:top;padding-right:1px;">';
      newRowAdd += '<input class="bracketvolume combo required number" name="bracketvolume_'+ (count)+ '" style="width:100px;height:20px;" />';
      newRowAdd += '<br/><div class="error_container"/></td><td></td><td style="vertical-align:top;padding-right:1px;"><input class="bracketprice combo required currency" name="bracketprice_'+ (count)+ '" style="height:20px;"/>';
      newRowAdd += '<br/><div class="error_container"/></td><td></td><td><img id ="removeRow_'+ (count)+ '" class="removeRowMultiple" src="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/images/details_close.png')}"/><b>&nbsp;Remove</b></td></tr>';
  $('#brackettablenext').append(newRow);
  $('#brackettable').append(newRowAdd);
  
  $('.removeRowMultiple').click(function(){

  var rowcount = $(this).attr('id');
      
     rowcount = rowcount.replace('removeRow_','');
     
      $(this).parent().parent().remove();
      
      $('.bracketcontainernext').each(function( index ){
          var rowcountnext =  $(this).attr('id');
          
          rowcountnext = rowcountnext.replace('bracketcontainernextid_','');
          if(rowcount == rowcountnext){
          
          $(this).remove();

          }
          
        }); 
                   
         $('.bracketcontainer').each(function(i, bc){
         $(this).find('.bracketvolume').attr('name', 'bracketvolume_' + i);
         $(this).find('.bracketprice').attr('name', 'bracketprice_' + i);
         
      });
      
       $('.bracketcontainernext').each(function(i, bc){
       
         $(this).find('.bracketvolume').attr('name', 'bracketvolumenext_' + i);
         $(this).find('.bracketprice').attr('name', 'bracketpricenext_' + i);
         
      });
                   
  

          


      

   });

}



function fnAddRow(){

  var count = $('.bracketcontainer').size();
  var newRow = '<tr class="bracketcontainer" style="height:10px;"><td style="vertical-align:top;padding-right:1px;">';
      newRow += '<input class="bracketvolume combo required currency" name="bracketvolume_'+ (count)+ '" style="width:100px;height:20px;" />';
      newRow += '<br/><div class="error_container"/></td><td></td><td style="vertical-align:top;padding-right:1px;"><input class="bracketprice combo required currency" name="bracketprice_'+ (count)+ '" style="height:20px;"/>';
      newRow += '<br/><div class="error_container"/></td><td></td><td><img class="removeRow" src="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/images/details_close.png')}"/><b>&nbsp;Remove</b></td></tr>';

  $('#brackettable').append(newRow);
  $('.removeRow').click(function(){ 
      $(this).parent().parent().remove();
      $('.bracketcontainer').each(function(i, bc){
         $(this).find('.bracketvolume').attr('name', 'bracketvolume_' + i);
         $(this).find('.bracketprice').attr('name', 'bracketprice_' + i);
      });

   }); 

}



function fnInitAddMaterial(){
    $('#dd2').dialog({  
          title: 'Add New Material',  
          width: 475,  
          height: 275,     
          closed: true,  
          cache: false, 
          modal: true,
          toolbar:[{
                text:'Save',
                iconCls:'icon-save',
                disabled:false,
                id:'SaveBtn',
                handler:function(){
                $(this).linkbutton('disable'); 
                
                if($('#AM_add_Pros_Mat').is(":checked")){
                
                    var bValid = $('#amform').form('validate'); 
                    if(bValid){
                    
                         
                         if(($('#supplierlookup').combogrid('getText')) == null || ($('#supplierlookup').combogrid('getText')) == '' || ($('#Description').val()) == null || ($('#Description').val()) == '' || ($('#containerfornewmaterial').val()) == null || ($('#containerfornewmaterial').val()) == '' || ($('#AM_add_acc').val()) == '' || ($('#AM_add_acc').val()) == null)
                         {
                            alert('Account and Prospect material details are required');
                            $('#SaveBtn').linkbutton('enable');
                         }
                         else 
                             {
                             Nexprice.saveaccountwomaterial($('#AM_add_acc').val(), $('#supplierlookup').combogrid('getText'), $('#Description').val(),$('#containerfornewmaterial ').val(),function(result, event){   
                             if(event.type == 'exception') {
                                 alert('Error occured while adding new material:'+event.message); 
                                 $('#SaveBtn').linkbutton('enable');
                                 $('#dd2').dialog('close');
                                   
                             } else {
                                 var bAdded = (result.length > 0);
                                 if(bAdded){
                                            
                                     fnAddData(result,$('#price_maintenance').dataTable());
                                     
                                     $('#dd2').dialog('close');
                                 }
                             }
                         },{buffer: true, escape: true, timeout:120000} );
                             
                             //$(this).linkbutton('enable');
                             
                             $('#dd2').dialog('close');                         
                             $('#Description').val('');
                             $('#containerfornewmaterial').val('');                             
                             $('#supplierlookup').combogrid('setValue','');
                             $('#AM_add_Pros_Mat').removeAttr('checked'); 
                         }   
                     }
                                          
                }else {
                  
                    var bValid = $('#amform').form('validate');
                    if(bValid)
                    {
                        if($('#AM_add_material').val() == null || $('#AM_add_acc').val() == null){
                            alert('Account and SAP Material is required to Add Material.');
                            $('#SaveBtn').linkbutton('enable');
                        }
                        else
                        {  
                            Nexprice.CheckDuplicateAM($('#AM_add_acc').val(), $('#AM_add_material').val(), function(result, event){
                            if(event.type == 'exception') {
                                alert('Error occured while adding Material record:'+event.message); 
                                $('#SaveBtn').linkbutton('enable');
                                $('#dd2').dialog('close');  
                            } else { 
                                  
                                 var bAdded = (result.length > 0);
                                 if(bAdded){
                                     alert("Cannot add this material. This material already exists on this customer. Please use the material filter to locate it");
                                     $('#SaveBtn').linkbutton('enable');
                                 } else
                                   {
                                      
                                      Nexprice.saveaccountmaterial($('#AM_add_acc').val(), $('#AM_add_material').val(), function(result, event){
                                          
                                          if(event.type == 'exception') {
                                             alert('Error occured while adding Material record:'+event.message); 
                                             $('#SaveBtn').linkbutton('enable');
                                             $('#dd2').dialog('close');  
                                          }else {
                                            
                                             var bAdded = (result.length > 0);
                                             if(bAdded){
                                                 
                                                 fnAddData(result,$('#price_maintenance').dataTable());
                                                  
                                                  $('#dd2').dialog('close');
                                                 
                                             }
                                          }
                                      },{buffer: true, escape: true, timeout:120000} ); 
                                       
                                        
                                   }
                               } 
                             });
                         }
                       
                    
                    
                     } 
                        
              
               }
               }
               },{
                    text:'Cancel',
                    iconCls:'icon-cancel',
                    handler:function(){
                        $('#dd2').dialog('close');
                        $('#Description').val('');
                        $('#containerfornewmaterial').val('');      
                        $('#supplierlookup').combogrid('setValue','');
                        $('#AM_add_Pros_Mat').removeAttr('checked');
                        $('#dmat').show();
                        $('#dd21').hide();
                        
                                         
                    }
               }]   
   });

        
    $('#addmaterial').click(function(){ 
          if($('#mm1').menu('findItem', 'Add Material').disabled == false)
          { 
            
            $('#dd2').dialog('open');
            $('#SaveBtn').linkbutton('enable');
            var sAcc = '';
            var ship_to = new Array();                     
            var shtoowners = new Array();
            shtoowners = $("#shtoowners").val();
            ship_to = $("#shto").val();
            $('#AM_add_acc').multiselect('widget').find('input').val('');
            $('#AM_add_acc').empty();
            $('#AM_add_acc').multiselect('refresh');
                                 
            if( $('.advanced').is(':visible') == false)
             {$("#UserLookup").multiselect("widget").find(":checkbox").each(function(){
                 if( $(this).val() === '{!myEmpId}')
                    if($(this).prop('checked') == false)
                        this.click();
                    
               });
             }
            
            if(shtoowners == null){
             if($('.advanced').is(':visible') == true)
             $('#UserLookup').multiselect("widget").find(":checkbox").each(function(){
               if($(this).prop('checked') == true)
                              this.click(); 
            });}
                               
            if(shtoowners != null){
             $('#UserLookup').multiselect("widget").find(":checkbox").each(function(){
               if($(this).prop('checked') == true)
                              this.click(); });
                              
                 for(var j=0; j < shtoowners.length; j++){
                  $('#UserLookup').multiselect("widget").find(":checkbox").each(function(){
                        if(shtoowners[j] == $(this).val())
                          {  if($(this).prop('checked') == false)
                                  this.click();
                           } });}
             }
                     
            if(ship_to == null && $("#corp").val() == null && $("#sldto").val() == null){
                   $("#mdivs").multiselect("widget").find(":checkbox").each(function(){
                   if($(this).prop('checked') == false)
                   this.click();
            });
            $("#morgs").multiselect("widget").find(":checkbox").each(function(){
                   if($(this).prop('checked') == false)
                   this.click(); });
                              
            }
            else{
            
            Nexprice.getAccountDetails($("#corp").val(), $("#sldto").val(), $("#shto").val(), function(result, event){
                    if(event.type == 'exception') {
                            
                    } else { 
                       
                        $("#mdivs").multiselect("widget").find(":checkbox").each(function(){
                               if($(this).prop('checked') == true)
                                  this.click();
                        });
                        $("#morgs").multiselect("widget").find(":checkbox").each(function(){
                               if($(this).prop('checked') == true)
                                 this.click(); 
                        }); 
                       var asDivs = new Array();
                       var asOrgs = new Array();
                       $(result.rows).each(function(i, r){
                        if(jQuery.inArray(r.SAP_DivisionCode__c, asDivs) == -1)
                         {  asDivs.push(r.SAP_DivisionCode__c);
                            $('#mdivs').multiselect("widget").find(":checkbox").each(function(){
                                if($(this).val() == r.SAP_DivisionCode__c)
                                   this.click();
                            });
                         }
                         if(jQuery.inArray(r.SAP_Sales_Org__c, asOrgs) == -1)
                         {  asOrgs.push(r.SAP_Sales_Org__c);
                            $('#morgs').multiselect("widget").find(":checkbox").each(function(){
                              if($(this).val() == r.SAP_Sales_Org__c)
                                this.click();
                            });
                         }
                          if(result.rows.length == 1)
                              sAcc += '<option selected="selected" value="' + r.Id + '" data-id="' + r.Id + '">' + r.Name + ' - ' + r.AccountNumber + ' / ' + r.SAP_Sales_Org__c + ' / ' + r.SAP_DivisionCode__c + '</option>';
                          else
                              sAcc += '<option value="' + r.Id + '" data-id="' + r.Id + '">' + r.Name + ' - ' + r.AccountNumber + ' / ' + r.SAP_Sales_Org__c + ' / ' + r.SAP_DivisionCode__c + '</option>';   
                       
                       });                  
                       
                       $('#AM_add_acc').append(sAcc);
                       $('#AM_add_acc').multiselect('refresh');
                       
                 }      
            }, {buffer: true, escape: true, timeout:120000}); }
            $('#AM_add_material').empty();
            $('#AM_add_material').multiselect('widget').find('input').val('');
            $('#AM_add_material').multiselect('refresh'); 
            
          } });
}
  

<!-- Added code for RFQ -->
function fnrfq(){
$('#qq2').dialog({  
          title: 'Add SAP Material',  
          width: 475,  
          height: 275,     
          closed: true,  
          cache: false, 
          modal: true,
          resizable:true,
          
          maximizable:true,
          collapsible:true,
          toolbar:[{
                text:'Save',
                iconCls:'icon-save',
                handler:function(){
                    var aSel= new Array();
                    $('#quotetable').find('input:checked').each(function(i, sel){ aSel.push($(sel).val()); });
                    if(aSel.size > 1)
                        alert('Only one record can be modified at a time.'); 
                    else{
                         if($('#sap_material').val() == null || $('#sap_material').val() == ''){
                             alert('Please enter material.');
                         }
                         else{
                             var oTable1 = $('#quotetable').dataTable();
                             $(".SelectedAudit").each(function(i, v){
                             if($(this).attr("checked") == "checked")
                             {    var nTr = this.parentNode.parentNode;
                                  aData = oTable1.fnGetData( nTr );
                             }});
                             
                             $('#qq2').dialog('close');
                             $('#loadtarget2').empty();
                             var acc = new Array();
                             acc.push(aData.Account_Material__r.Account__c)
                                                 
                             Nexprice.CheckDuplicateAM(acc, $('#sap_material').val(), function(result, event){
                                if(event.type == 'exception') {
                                    alert('Error occured while adding Material record:'+event.message); 
                                    $('#dd2').dialog('close');  
                                } else { 
                                      var bAdded = (result.length > 0);
                                     if(bAdded){
                                         if(result[0].CPI_Deletion_Flag__c == 'X')
                                             alert('Cannot add this material. Please check with your CSR to make sure this CPI is not marked for deletion.'); 
                                         else 
                                             alert("Cannot add this material. This material already exists on this customer. Please use the material filter to locate it");                              
                                         }else{
                                              if(aSel.length > 0)
                                              $('#loadtarget2').load('/apex/RFQ_Reject_Alternate_Form?ids=' + aSel.join('-')+'&opt=convert&mat=' +$('#sap_material').val(), function() {
                                                  var table = 'quotetable';
                                                  fnInitForm(table);
                                                  $('#forrfq').hide();
                                                  $('#forrfq2').hide();
                                                  $('#freightlbl').show();
                                                  $('#freightoptions').show();
                                             
                                    
                                              });   
                                         }
                                 }    
                               }); 
                           }    
                    }
                }
                },{
                text:'Cancel',
                iconCls:'icon-cancel',
                handler:function(){$('#qq2').dialog('close');}
               } ]
            });
       $('#convertrfq').click(function(){ 
           if($('#mm21').menu('findItem', 'Convert RFQ').disabled == false){
               fnDisablefilter('quotetable');
               var oTable1 = $('#quotetable').dataTable();
               
               
               
                   $(".SelectedAudit").each(function(i, v){
                     if($(this).attr("checked") == "checked")
                     {   var nTr = this.parentNode.parentNode;
                         aData = oTable1.fnGetData( nTr );
                      }});
                 
                    
                  if(aData.Prospect_Material__c == true)
                    {                       
                        $('#qq2').dialog('open');
                    }
                  else if(aData.Prospect_Material__c != true && aData.Approval_Status__c == 'Expired')
                  {
                   $('#loadtarget2').empty();
                     aSel= new Array();
                    $('#quotetable').find('input:checked').each(function(i, sel){ aSel.push($(sel).val()); });
                    
                     if(aSel.length> 1)
                        alert('Only one record can be converted at a time.');
                     if(aSel.length == 1){
                          $('#loadtarget2').load('/apex/RFQ_Reject_Alternate_Form?ids=' + aSel.join('-') +'&opt=convert', function() {
                            var table = 'quotetable';
                            fnInitForm(table);
                            $('#forrfq').hide();
                            $('#forrfq2').hide();
                            $('#freightlbl').show();
                            $('#freightoptions').show();
                            //$('#freight').attr('data-value') == '';
                           
                         });  }
                  }
                  else{
                    fnReleaseQuote();
                                    
                  }
          }});
          
          } 
<!--Code change end-->  

<!-- Added code for Account Material Change -->
function fnAccntMatSearchBox( oWidget, oSel, sName){
var oTable = $('#price_maintenance').dataTable();
var oInput = $(oWidget).find('input');
var aaSelected = new Array();
var aaExisting = new Array();
var showAll;

$(".singleselect").each(function(i, mselect){
             aaSelected[$(mselect).attr('name')] = new Array();
             aaExisting[$(mselect).attr('name')] = new Array();
             $(mselect).multiselect("getChecked").each(function(){aaSelected[$(mselect).attr('name')].push(this.value); });     
             $(mselect).find("option").each(function(){aaExisting[$(mselect).attr('name')].push($(this).attr('data-id')); });            
             
           });
           var aaOwner = new Array();
           var aaOrg = new Array();
           var aaDiv = new Array();
          
           
if(sName == 'Account')
{
                 aaOwner = $('#UserLookup').val();
                 
                 var f = '(NOT NAME LIKE \'%DO NOT%\') and type = \'Customer\' and recordtype.Name = \'Distribution Customer\' AND Inactive_Account__c != true AND (Name LIKE \'%' + $(oInput).val() + '%\'  or AccountNumber LIKE \'%' + $(oInput).val() + '%\' )';
                 
                 $(oWidget).find('.iSearch').show();
                 $(oWidget).find('.iClear').hide();
                 if($(oSel).is('[data-searching]') == false)
                 {
                    $(oSel).attr('data-searching', 'searching');
                    
                  Nexprice.getSingleOptions(sName, [], $(oInput).val(), 'Account', 'Name, AccountNumber, SAP_Sales_Org__c, SAP_DivisionCode__c', f, aaOwner , aaOrg, aaDiv, 'Name ASC', '100', function(result, event){
                    $(oSel).removeAttr('data-searching');
                    if(event.type == 'exception') {         
                      $(oWidget).find('.iSearch').hide(); 
                      $(oWidget).find('.iClear').show();  

                    } else {     
                              
                       var sResult = '';
                       var aData = new Array();
                       
                       $(result.rows).each(function(i, r){
                         
                           sResult += '<option value="' + r.Id + '" data-id="' + r.Id + '">' + r.Name + ' - ' + r.AccountNumber + ' / ' + r.SAP_Sales_Org__c + ' / ' + r.SAP_DivisionCode__c + '</option>';
                       });   
                       
                       $(oSel).empty();
                       $(oSel).append(sResult);
                       $(oSel).multiselect('refresh');  
                       $(oWidget).find('.iSearch').hide();   
                       $(oWidget).find('.iClear').show();                        
                    }
                  }, {buffer: true, escape: true, timeout:120000});
                 }
}

if(sName == 'SAP Material')
{
                 aaOrg = $('#morgs').val();
                 aaDiv = $('#mdivs').val()
                 showAll = $("#AM_show_all_Mat").prop('checked');
                 
                 var f = '(NOT NAME LIKE \'%DO NOT%\') and Marked_for_Deletion__c != \'true\' and Name LIKE \'%' + $(oInput).val() + '%\'';
                 if(showAll == false)
                     f = f + 'and Material_General_Data__r.Ext_Material_Group_Code__c LIKE \'101\'';
                
                  $(oWidget).find('.iSearch').show();
                  $(oWidget).find('.iClear').hide();
                  
                  if($(oSel).is('[data-searching]') == false)
                  {
                    $(oSel).attr('data-searching', 'searching');
                  
                    Nexprice.getSingleOptions(sName,[],$(oInput).val(), 'Material_Sales_Data2__c', 'Name, Material_Number__c,  Sales_Org_Code__c, Division_Code__c', f, aaOwner , aaOrg, aaDiv, 'Name ASC', iLimit, function(result, event){
                    $(oSel).removeAttr('data-searching'); 
                    if(event.type == 'exception') {
                       
                        
                       $(oWidget).find('.iSearch').hide();   
                       $(oWidget).find('.iClear').show();  
                    } else {            
                       var sResult = '';
                       var aData = oTable.fnGetColumnData[aColumnIndex[$(oSel).attr('data-value')]];
                       $(result.rows).each(function(i, r){
                       if(jQuery.inArray(r.Id, aData) == -1)
                          sResult += '<option value="' + r.Id + '" data-id="' + r.Id + '">' + r.Name + ' / ' + r.Sales_Org_Code__c + ' / ' + r.Division_Code__c + '</option>';
                       }); 
                       
                       $(oSel).empty();
                       $(oSel).append(sResult);
                       $(oSel).multiselect('refresh');  
                       $(oWidget).find('.iSearch').hide();   
                       $(oWidget).find('.iClear').show();  
                                        
                    }
                  }, {buffer: true, escape: true, timeout:120000});
                 }
}

if(sName == 'RFQ Material')
{
                  var f = '(NOT NAME LIKE \'%DO NOT%\') and Marked_for_Deletion__c != \'true\' and Name LIKE \'%' + $(oInput).val() + '%\'';
                 
                  $(oWidget).find('.iSearch').show();
                  $(oWidget).find('.iClear').hide();
                  
                  if($(oSel).is('[data-searching]') == false)
                  {
                    $(oSel).attr('data-searching', 'searching');
                  
                    Nexprice.getSingleOptions2(sName, $(oInput).val(), 'Material_Sales_Data2__c', 'Name, Material_Number__c,  Sales_Org_Code__c, Division_Code__c', f, 'Name ASC', iLimit, function(result, event){
                    $(oSel).removeAttr('data-searching'); 
                    if(event.type == 'exception') {
                       $(oWidget).find('.iSearch').hide();   
                       $(oWidget).find('.iClear').show();  
                    } else {            
                       var sResult = '';
                       var aData = oTable.fnGetColumnData[aColumnIndex[$(oSel).attr('data-value')]];
                       $(result.rows).each(function(i, r){
                       if(jQuery.inArray(r.Id, aData) == -1)
                          sResult += '<option value="' + r.Id + '" data-id="' + r.Id + '">' + r.Name + ' / ' + r.Sales_Org_Code__c + ' / ' + r.Division_Code__c + '</option>';
                       }); 
                       
                       $(oSel).empty();
                       $(oSel).append(sResult);
                       $(oSel).multiselect('refresh');  
                       $(oWidget).find('.iSearch').hide();   
                       $(oWidget).find('.iClear').show();  
                                        
                    }
                  }, {buffer: true, escape: true, timeout:120000});
                 }

}

}
 <!--Code Change End -->

function fnInitSearchBox( oWidget, oSel, sName){
var oTable = $('#price_maintenance').dataTable();
var oInput = $(oWidget).find('input');
var aaSelected = new Array();
var aaExisting = new Array();


$(".mselect").each(function(i, mselect){
             aaSelected[$(mselect).attr('name')] = new Array();
             aaExisting[$(mselect).attr('name')] = new Array();
             $(mselect).multiselect("getChecked").each(function(){aaSelected[$(mselect).attr('name')].push(this.value); });     
             $(mselect).find("option").each(function(){aaExisting[$(mselect).attr('name')].push($(this).attr('data-id')); }); 
                                   
           });
          
if(sName == 'Sold To' || sName == 'Ship To' || sName == 'Corporate')
{
    
                 var excludes = '';
                 if(sName == 'Sold To')
                    excludes = 'SAP_Sold_To_Account_Id__c';
                 if(sName == 'Ship To')
                    excludes = 'Id';
                 var f = '((NOT NAME LIKE \'%DO NOT%\') and recordtype.Name = \'Distribution Customer\' AND Inactive_Account__c != true AND (Name LIKE \'%' + $(oInput).val() + '%\'  or AccountNumber LIKE \'%' + $(oInput).val() + '%\' ) ';
                 if(sName != 'Corporate'){
                    (sName == 'Sold To')? f += 'and SAP_Partner_Functions__c LIKE \'%SOLD%\')' : f += ' and SAP_Partner_Functions__c LIKE \'%SHIP%\')';
                 }
                 else{
                    f += 'and SAP_Partner_Functions__c = \'\')';
                    excludes = 'SAP_Corporate_Account_Id__c';
                 }
                 var j = 0;
                 var values;
                 $("select[data-acctfieldname]").each(function(i, mselect){
                 
                 
                        if(aaSelected[$(mselect).attr('name')].length != 0 && $(mselect).attr('data-acctfieldname') != excludes && $(mselect).attr('data-acctfieldname') != 'id'){
                        
                        if(j == 0) 
                          f += ' AND (';
                       values = '';
                       for(var k=0; k<aaSelected[$(mselect).attr('name')].length; k++)
                       { 
                         values +=   aaSelected[$(mselect).attr('name')][k] ;
                         
                         if($(mselect).attr('data-acctfieldname') == 'Team_Employee_Ids__c')
                             f += $(mselect).attr('data-acctfieldname') + " LIKE \'%" + aaSelected[$(mselect).attr('name')][k]+ "%\'";
                            
                         if((k < aaSelected[$(mselect).attr('name')].length-1) && ($(mselect).attr('data-acctfieldname') == 'Team_Employee_Ids__c'))
                             f += ' OR ';
                                        
                         if((k < aaSelected[$(mselect).attr('name')].length-1) && ($(mselect).attr('data-acctfieldname') != 'Team_Employee_Ids__c'))  
                             values += ',';
                         
                       }
                       if($(mselect).attr('data-acctfieldname') != 'Team_Employee_Ids__c' && $(mselect).attr('data-acctfieldname') != 'id')
                           f += $(mselect).attr('data-acctfieldname') + " in ( \'" + values +"\')"; 
                           f += ' OR ';
                          
                       j++;
                    }   
                               
                 });
                 
                 if(j>0)
                    f = f.substring(0,f.length-3)+' )';
                     
                 $(oWidget).find('.iSearch').show();
                 $(oWidget).find('.iClear').hide();
                 if($(oSel).is('[data-searching]') == false)
                  {
                    $(oSel).attr('data-searching', 'searching');
                   
                  Nexprice.getSelectOptions(aaExisting[$(oSel).attr('name')], $(oInput).val(), 'Account', 'Name, AccountNumber, SAP_Sales_Org__c, SAP_DivisionCode__c, SAP_City__c', f, 'Name ASC', '100', function(result, event){
                    $(oSel).removeAttr('data-searching');
                    if(event.type == 'exception') {         
                      $(oWidget).find('.iSearch').hide(); 
                      $(oWidget).find('.iClear').show();  

                      alert(event.message);

                    } else {     
    
                       var sResult = '';
                     //  var aData = oTable.fnGetColumnData[aColumnIndex[$(oSel).attr('name')]];
                       var aData = new Array();
                       $(oSel).find('option').each(function(i, opt){ aData.push($(opt).val()); });
                       $(result.rows).each(function(i, r){
                         if(jQuery.inArray(r.Id, aData) == -1)
                           sResult += '<option value="' + r.Id + '" data-id="' + r.Id + '">' + r.Name + ' - ' + r.AccountNumber + ' / ' + r.SAP_Sales_Org__c + ' / ' + r.SAP_DivisionCode__c + ' / ' + r.SAP_City__c + '</option>';
                         
                           
                       });   

                       $(oSel).append(sResult);
                       $(oSel).multiselect('refresh');  
                       $(oWidget).find('.iSearch').hide();   
                       $(oWidget).find('.iClear').show();                        
                    }
                  }, {buffer: true, escape: true, timeout:120000});
                 }
}
if(sName == 'Base Code')
{
                 var f = '(NOT Material_Base_Code_Description__c LIKE \'%DO NOT%\') and (Material_Base_Code_Description__c LIKE \'%' + $(oInput).val() + '%\' OR Material_Base_Code_w_o_G2__c LIKE \'%' + $(oInput).val() + '%\')';
                 $(oWidget).find('.iSearch').show();
                 $(oWidget).find('.iClear').hide();
                  if($(oSel).is('[data-searching]') == false)
                  {
                    $(oSel).attr('data-searching', 'searching');
                  Nexprice.getSelectOptions(aaExisting[$(oSel).attr('name')],$(oInput).val(), 'Material_Base_Code__c', 'Name, Material_Base_Code__c, Material_Base_Code_w_o_G2__c,  Material_Base_Code_Description__c', f, 'Name ASC', iLimit, function(result, event){
                    $(oSel).removeAttr('data-searching');
                    if(event.type == 'exception') {
                      $(oWidget).find('.iSearch').hide();
                      $(oWidget).find('.iClear').show();
                      alert(event.message);
                    } else {            
                       var sResult = '';
                     //  var aData = oTable.fnGetColumnData[aColumnIndex[$(oSel).attr('name')]];
                       var aData = new Array();
                       $(oSel).find('option').each(function(i, opt){ aData.push($(opt).val()); });
                       $(result.rows).each(function(i, r){
                       if(jQuery.inArray(r.Material_Base_Code__c, aData) == -1)
                          sResult += '<option value="' + r.Material_Base_Code__c + '" data-id="' + r.Id + '">' + r.Material_Base_Code_Description__c + ' - ' + r.Material_Base_Code_w_o_G2__c + '</option>';
                       });   

                       $(oSel).append(sResult);
                       $(oSel).multiselect('refresh');  
                       $(oWidget).find('.iSearch').hide();   
                       $(oWidget).find('.iClear').show();                        
                    }
                  }, {buffer: true, escape: true, timeout:120000});
                 }
}

if(sName == 'Material')
{
                 var f = '(NOT NAME LIKE \'%DO NOT%\') and Marked_for_Deletion__c != \'true\' and Name LIKE \'%' + $(oInput).val() + '%\'';
                  $("select[data-matfieldname]").each(function(i, mselect){

                       for(var j=0; j<aaSelected[$(mselect).attr('name')].length; j++)
                       {
                          if(j == 0)
                            f += ' AND (';
                          f += $(mselect).attr('data-matfieldname') + " = \'" + aaSelected[$(mselect).attr('name')] + "\'";
                          if(j < aaSelected[$(mselect).attr('name')].length-1)
                            f += ' OR ';
                          else
                            f += ')';
                       }                      
                 }); 
                  $(oWidget).find('.iSearch').show();
                  $(oWidget).find('.iClear').hide();
                  
                  if($(oSel).is('[data-searching]') == false)
                  {
                    $(oSel).attr('data-searching', 'searching');
                  
                    Nexprice.getSelectOptions(aaExisting[$(oSel).attr('name')],$(oInput).val(), 'Material_Sales_Data2__c', 'Name, Material_Number__c,  Sales_Org_Code__c, Division_Code__c', f, 'Division_Code__c ASC, Name ASC', iLimit, function(result, event){
                    $(oSel).removeAttr('data-searching'); 
                    if(event.type == 'exception') {

                       alert(event.message); 
                       $(oWidget).find('.iSearch').hide();   
                       $(oWidget).find('.iClear').show();  
                    } else {            
                       var sResult = '';
                       //var aData = oTable.fnGetColumnData[aColumnIndex[$(oSel).attr('data-value')]];
                       
                       var aData = new Array();
                       $(oSel).find('option').each(function(i, opt){ aData.push($(opt).val()); });
                       $(result.rows).each(function(i, r){
                        if(jQuery.inArray(r.Material_Base_Code__c, aData) == -1)
                          sResult += '<option value="' + r.Id + '" data-id="' + r.Id + '">' + r.Name + ' / ' + r.Sales_Org_Code__c + ' / ' + r.Division_Code__c + '</option>';
                       }); 
                       $(oSel).append(sResult);
                       $(oSel).multiselect('refresh');  
                       $(oWidget).find('.iSearch').hide();   
                       $(oWidget).find('.iClear').show();  
                                        
                    }
                  }, {buffer: true, escape: true, timeout:120000});
                 }
}
}
function fnInitForm(table){

$.datepicker.setDefaults({ beforeShow: function (i) { if ($(i).attr('readonly')) { return false; } } }); 

$('.addRow').click(function(){ fnAddRow();});
$('.addRowCSP').click(function(){ fnAddRowCSP(); });

$('.removeRowMultiple').click(function(){

  var rowcount = $(this).attr('id');
   
     $(this).parent().parent().remove();
     rowcount = rowcount.replace('removeRow_','');
     
      
      
      $('.bracketcontainernext').each(function( index ){
          var rowcountnext =  $(this).attr('id');
          
          rowcountnext = rowcountnext.replace('bracketcontainernextid_','');
          
          if(rowcount == rowcountnext){
          
          $(this).remove();

          }
          
        }); 
                   
         $('.bracketcontainer').each(function(i, bc){
        
         $(this).find('.bracketvolume').attr('name', 'bracketvolume_' + i);
         $(this).find('.bracketprice').attr('name', 'bracketprice_' + i);
      });
      $('.bracketcontainernext').each(function(i, bc){
      
         $(this).find('.bracketvolume').attr('name', 'bracketvolumenext_' + i);
         $(this).find('.bracketprice').attr('name', 'bracketpricenext_' + i);
         
      });
     
   });
   
     $('.removeRow').click(function(){
      $(this).parent().parent().remove();
      $('.bracketcontainer').each(function(i, bc){
         $(this).find('.bracketvolume').attr('name', 'bracketvolume_' + i);
         $(this).find('.bracketprice').attr('name', 'bracketprice_' + i);
      });

   });
   
   
   if(table == 'price_maintenance'){
       fnFormTable();
   
   }
   else{
       fnFormTableQuote();
   }
   
   var uoms = new Array();
   $('#compuom').find('option').each(function(i, opt){ uoms.push($(opt).val()); });
   $('.easyui-combo').combobox({editable:false, panelHeight: 'auto'});
   $('#pacCode').combobox({editable:false});
   $('#pacCode').combobox('setValue', $('#pacCode').attr('data-value'));
   $('#pacCode1').combobox({editable:false});
   $('#supplier').combobox({editable:false});
   $('#supplier1').combobox({editable:false});
   $('#supplier').combobox('setValue', $('#supplier').attr('data-value'));
   $('#pacCode1').combobox('setValue', $('#pacCode1').attr('data-value'));
   
   $('#priceprot').combobox({editable:false});
   var oTable = $('#price_maintenance').dataTable();
   var TR = $('#price_maintenance').find('tr').has('input:checked').first();
   var pp = oTable.fnGetData(TR[0]);

   $('#priceprot').combobox('setValue', 'Default Price Protection');
   $('#priceprot').combobox('setText', 'Default Price Protection');
   $('#drumdep').combobox('setValue', 'Default Drum Deposit');
   $('#drumdep').combobox('setText', 'Default Drum Deposit');
   
   
       
   $('#freight').combobox({editable:false});
   
   aSel = new Array();
   $('#price_maintenance').find('input:checked').each(function(i, sel){ aSel.push($(sel).val()); });
   
   if(aSel.length > 1 && $('#freight').attr('data-value') != '')
   {
       $('#freight').combobox('setValue', 'No Change');
       $('#freight').combobox('setText', 'No Change');
      
       $('#freightval').val('No Change');
   }         
   
   if(aSel.length == 1 && $('#freight').attr('data-value') == ''){
       $('#freight').combobox('setValue', '');
       $('#freight').combobox('setText', '');
       $('#freightval').val('');
   }
      
   if(aSel.length == 1 && $('#freightMatch').val() == 'No')
       $("#freight").combobox('disable');
   
      
   $('#currencies').combobox('setValue', $('#currencies').attr('data-value'));
   $('.set').each(function(i, u){ $(u).combobox('setValue', $(u).attr('data-value'));});
   $('.uom').each(function(i, u){ if(jQuery.inArray($(u).attr('data-value'), uoms) > -1){ $(u).combobox('setValue',  $(u).attr('data-value')); } });
   $('.easyui-linkbutton').linkbutton({plain:false});
   
   $('#SaveSubmit').linkbutton('disable');
   
   if(table == 'price_maintenance')
   {
       var oTable = $('#price_maintenance').dataTable();
       $(".select_row").each(function(i, v){
       if($(this).attr("checked") == "checked")
       {   var nTr = this.parentNode.parentNode;
           aData = oTable.fnGetData( nTr );
       }});
       
       if(aData.Prospect_Material__c == false){
          if($('#opt').val() == 'RFQ'){  
               $('#rfqattr').show();
               $('#rfqattr2').show();
              
                
               $("#application").addClass('required');
               $("#oem").addClass('required');
               $("#SpecifiedMaterial").addClass('required');
               $("#estanualVol").addClass('required');  
               $("#pacCode").addClass('required');
           }
           else{
               $('#freightlbl').show();
               $('#freightoptions').show(); }
           
           
       }

   }
   else{
       var oTable1 = $('#quotetable').dataTable();
         $(".SelectedAudit").each(function(i, v){
         if($(this).attr("checked") == "checked")
         {   var nTr = this.parentNode.parentNode;
             aData = oTable1.fnGetData( nTr );
          }});
    
       if(aData.Prospect_Material__c == false){
           
           $('#Simulate').linkbutton('enable');
           $('#SaveSubmit').linkbutton('disable');
           $('.rfq').hide();
           $('.quote').show();
         
           if(aData.Type__c == 'RFQ'){
               
               $('#forrfq').show();
               $('#forrfq2').show();  
               $('.pros').hide(); 
               $('#freightlbl').hide();
               $('#freightoptions').hide();
               $('#freight').hide();
               
           }else{
               $('#forrfq').hide();
               $('#forrfq2').hide();
           }
    
                 
       }
       else{
           $('#forrfq').show();
           $('#forrfq2').show();
           $('#SimulateCM').hide();
           $('#freightlbl').hide();
           $('#freightoptions').hide();
           $('#freight').hide();
           
           if($('#opt').val() == 'modify'){
               $('#Simulate').linkbutton('disable');
               $('#SaveSubmit').linkbutton('enable');
               $('.rfq').show();
               $('.quote').hide() 
               $('#simulate22').hide();}
           else if($('#opt').val() == 'convert') {
               $('#Simulate').linkbutton('enable');
               $('#SaveSubmit').linkbutton('disable');
               $('.rfq').hide();
               $('.quote').show() 
               $('#simulate22').show();
           
           }
       }
   
   }
   
    $('.bracketcontainer').each(function(i, bc){
         $(this).find('.bracketvolume').attr('name', 'bracketvolume_' + i);
         $(this).find('.bracketprice').attr('name', 'bracketprice_' + i);
      });
      
      $('.bracketcontainernext').each(function(i, bc){
      
         $(this).find('.bracketvolume').attr('name', 'bracketvolumenext_' + i);
         $(this).find('.bracketprice').attr('name', 'bracketpricenext_' + i);
         
      });

   /*adding for rfq page*/
   $('#SaveSubmitrfq').linkbutton('enable');
  
   
   $( "#pricetype" ).change(function() {
        if($(this).val() == "RFQ") {
           $("#rfqattr").show();
           $("#rfqattr2").show();
           $("#application").addClass('required');
           $("#pacCode").addClass('required');
           $("#oem").addClass('required');
           $("#SpecifiedMaterial").addClass('required');
           $("#estanualVol").addClass('required');
           }
        else{    
           $("#rfqattr").hide();
           $("#rfqattr2").hide(); 
    
           }           
   });
     
    
          
   $("#SpecifiedMaterial").prop("selectedIndex", -1);
   $("#ExistingBusiness").prop("selectedIndex", -1);
     
   $( "#edate" ).datepicker({ minDate: 0, required:true , editable:false, dateFormat: "{!dateFormat}" });
   $( "#exdate" ).datepicker({ minDate: 0, maxDate: "+1Y", required:true, editable:false, dateFormat: "{!dateFormat}" });
   $( "#edatenext" ).datepicker({ minDate: -1, maxDate: -2, required:true , editable:false, dateFormat: "{!dateFormat}" }).attr('readonly','readonly');
   $( "#exdatenext" ).datepicker({ minDate:"+1Y +1d" , maxDate: "+2Y", required:true, editable:false, dateFormat: "{!dateFormat}" });
   $( "#edate" ).change(function() {
              var date =$('#edate').datepicker('getDate');
              var d = date.getUTCDate();
              var m = date.getUTCMonth();
              var y = date.getUTCFullYear();
              var newdate = new Date(y+1, m, d);   
              $( "#exdate" ).datepicker( "option" ,{ minDate: date, maxDate: newdate, required:true, dateFormat: "{!dateFormat}"});
              $( "#exdate" ).datepicker( "setDate" , newdate );
              var newdate1 = new Date(y+1, m, d+1); 
              $( "#edatenext" ).datepicker( "option" ,{ minDate: date, maxDate: newdate1, required:true, dateFormat: "{!dateFormat}"});
              $( "#edatenext" ).datepicker( "setDate" , newdate1 );
                            
              var newdate2 = new Date(y+2, m, d+1); 
              $( "#exdatenext" ).datepicker( "option" ,{ minDate: $('#edatenext').datepicker('getDate'), maxDate: newdate2, required:true, dateFormat: "{!dateFormat}"});
              $( "#exdatenext" ).datepicker( "setDate" , newdate2 );


   });
   $( "#exdate" ).change(function() {
              var date =$('#exdate').datepicker('getDate');
              var d = date.getUTCDate();
              var m = date.getUTCMonth();
              var y = date.getUTCFullYear();
              var newdate = new Date(y, m, d+1);   
              $( "#edatenext" ).datepicker( "option" ,{ minDate: date, maxDate: newdate, required:true, dateFormat: "{!dateFormat}"});
              $( "#edatenext" ).datepicker( "setDate" , newdate );
                            
              var newdate1 = new Date(y+1, m, d+1);   
              $( "#exdatenext" ).datepicker( "option" ,{ minDate: date, maxDate: newdate1, required:true, dateFormat: "{!dateFormat}"});
              $( "#exdatenext" ).datepicker( "setDate" , newdate1 );

   });
      
     
   $('#Competitors').combogrid({  
        panelWidth:200, 
        width:200, 
        value:'',    
        delay: 500,  
        idField:'Id',  
        textField:'Name', 
        keyHandler: {
          query: function(q){
                  var g = $(this).combogrid('grid');
                  var aSel = new Array();
                     $('#price_maintenance').find('input:checked').each(function(i, sel){ aSel.push($(sel).val());                      
                     });
                     
                  Nexprice.getComboGridData(q, 'Nexeo_Competitor__c', 'Name', 'status__c = \'Active\' and Competitor_or_Supplier__c = \'Competitor\'', 'Name ASC', '1000', aSel.join('-') , function(result, event){
                    if(event.type == 'exception') {
                      alert(event.message);
                    } else {      
                      g.datagrid('loadData', result);         
                    }
                  }, {buffer: true, escape: true, timeout:120000});
           }
        },
        columns:[[  
               {field:'Name',title:'Name',width:300} 
        ]],
        loader: function(param,success,error){
        
            Nexprice.getComboGridData('', 'Nexeo_Competitor__c', 'Name', 'status__c = \'Active\' and Competitor_or_Supplier__c = \'Competitor\'', 'Name ASC', '1000', aSel.join('-') , function(result, event){

             if(event.type == 'exception') {
                alert(event.message);        
             } else { 
              
               success(result);         
             }
         }, {buffer: true, escape: true, timeout:120000});
        },
        onSelect: function(param){ fixEscapedHTML($('#Competitors').combogrid('getText'), 'Competitors');
                                   if($('#Competitors').combobox('getValue') != '')
                                  { $('#CompetitorsFrame').removeClass('error');
                                    $('#CompetitorsError').html('');
                                  }           
        }
    });
   
   $('#Competitors').combogrid('textbox').focusin(function(){ 
        $('#Competitors').combogrid('clear');
     });
   $('#Competitors').combogrid('textbox').blur(function(){ 
        if($('#Competitors').combobox('getValue') == '' && $('#CompetitorsFrame').attr('data-submitted') == 'submitted')
        { $('#CompetitorsFrame').addClass('error');
          $('#CompetitorsError').html('This field is required.');
        }
     });
   $('#Competitors').combogrid('setValue', $('#Competitors').attr('data-compid'));
   fixEscapedHTML($('#Competitors').attr('data-compname'), 'Competitors');

   $('#edate').keyup(function(){ $(this).val('')});
   $('#exdate').keyup(function(){ $(this).val('')});
   $('#exdate').datepicker( "hide" );
   $('#edatenext').keyup(function(){ $(this).val('')});
   
   $('#exdatenext').keyup(function(){ $(this).val('')});
   $('#exdatenext').datepicker( "hide" );
   

    $("#createform").validate({
       errorPlacement: function(error, element){
          error.insertAfter(element.parent().find('.error_container'));
          error.css('color', 'red');  
       }
    });
    
    $("#createformrfq").validate({
       errorPlacement: function(error, element){
          error.insertAfter(element.parent().find('.error_container'));  
          error.css('color', 'red');
       }
    });
    jQuery.validator.addMethod("currency", function(value, element) {
        var curr = $("#currencies").combobox('getValue'); 
        
        if(curr == 'USD' || curr == 'CAD')
            return this.optional(element) || /^([1-9]{1}[0-9]{0,2}(\,[0-9]{3})*(\.[0-9]{2})?|[1-9]{1}[0-9]{0,}(\.[0-9]{2})?|0(\.[0-9]{2})?|(\.[0-9]{2})?)$/.test(value);         
        else
            return this.optional(element) || /^([1-9]{1}[0-9]{0,2}(\,[0-9]{3})*(\.[0-9]{4})?|[1-9]{1}[0-9]{0,}(\.[0-9]{4})?|0(\.[0-9]{4})?|(\.[0-9]{4})?)$/.test(value);         
    }, "Please enter a valid number.");
       
    jQuery.validator.addMethod("isText", function(value, element) { 
          return this.optional(element) || /^[a-zA-Z]/.test(value); 
       }, "Please enter valid text.");
 
}

function fninitformpsr(){

   $( "#psreffdate" ).datepicker({ minDate: null, required:true , editable:false, dateFormat: "{!dateFormat}" });
   $( "#psrexpdate" ).datepicker({ minDate: 0, maxDate: "+1Y", required:true, editable:false, dateFormat: "{!dateFormat}" });
   $('#psreffdate').keyup(function(){ $(this).val('')});
   $('#psrexpdate').keyup(function(){ $(this).val('')});
   $( "#psreffdate" ).change(function() {
              var date =$('#psreffdate').datepicker('getDate');
              var d = date.getUTCDate();
              var m = date.getUTCMonth();
              var y = date.getUTCFullYear();
              var newdate = new Date(y+1, m, d);   
              $( "#psrexpdate" ).datepicker( "option" ,{ minDate: date, maxDate: newdate, required:true, dateFormat: "{!dateFormat}"});
              $( "#psrexpdate" ).datepicker( "setDate" , newdate );
   });
   
   $('#sapplant').combogrid({  
        panelWidth:200, 
        width:200, 
        value:'',    
        delay: 500,  
        idField:'Id',  
        textField:'Plant_Name__c', 
        keyHandler: {
          query: function(q){
                  var g = $(this).combogrid('grid');
                                       
                  Nexprice.getsapplant(q, function(result, event){
                    if(event.type == 'exception') {
                      alert(event.message);
                    } else {      
                      g.datagrid('loadData', result);         
                    }
                  }, {buffer: true, escape: true, timeout:120000});
           }
        },
        columns:[[  
               {field:'Plant_Code__c',title:'Code',width:50},
               {field:'Plant_Name__c',title:'Name',width:200}  
        ]],
        loader: function(param,success,error){
        
            Nexprice.getsapplant('', function(result, event){

             if(event.type == 'exception') {
                alert(event.message);        
             } else { 
              
               success(result);         
             }
         }, {buffer: true, escape: true, timeout:120000});
        },
        onSelect: function(param){ fixEscapedHTML($('#sapplant').combogrid('getText'), 'sapplant');
                                   if($('#sapplant').combobox('getValue') != '')
                                  { $('#PlantFrame').removeClass('error');
                                    $('#PlantError').html('');
                                  }           
        }
    });
   
   $('#sapplant').combogrid('textbox').focusin(function(){ 
        $('#sapplant').combogrid('clear');
     });
   $('#sapplant').combogrid('textbox').blur(function(){ 
        if($('#sapplant').combobox('getValue') == '' && $('#PlantFrame').attr('data-submitted') == 'submitted')
        { $('#PlantFrame').addClass('error');
          $('#PlantError').html('This field is required.');
        }
     });
   $('#sapplant').combogrid('setValue', $('#sapplant').attr('data-compid'));
   fixEscapedHTML($('#sapplant').attr('data-compname'), 'sapplant');
   
}

function fnFormTable(){
$('#formtable').dataTable({
"bJQueryUI": true,
"fnCreatedRow": function( nRow, aData, iDataIndex ) {
                    $('td:eq(0)', nRow).html( '<img class="details_img" src="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/images/details_open.png')}">' );
                    fnSetImgListener(nRow, 'formtable');
},
"aoColumnDefs": [
                    { "aTargets":[ "level" ],"mData": "Approval_Level__c"},
                    { "aTargets":[ "appr" ],"mData": "Approver__r.Name" },
                    { "aTargets":[ "type" ],"mData": "Type__c" },
                    { "aTargets":[ "CM" ],"mData": "CM_Percent__c" },
                    { "aTargets":[ "Unit_CM" ],"mData": "Unit_Contribution_Margin__c" },
                    { "aTargets":[ "sold" ],"mData": "Account_Material__r.Account_Sold_To__c" },
                    { "aTargets":[ "ship" ],"mData": "Account_Material__r.Account_Name__c" },
                    { "aTargets":[ "mat" ],"mData": "Account_Material__r.Material_Name__c" },
                    { "aTargets":[ "start" ],"mData": "Requested_Effective_Date__c" ,
                    "mData": function ( source, type, val ) {
                          if (type === 'set') {
                              return;
                          }
                          else if (type === 'display' || type == 'filter') {
                            if((typeof source.Requested_Effective_Date__c == 'undefined') && source.Requested_Effective_Date__c == null)
                              return '';
                            else 
                             {var ReqDate = new Date(source.Requested_Effective_Date__c);
                              if('{!DateFormat}' == 'mm/dd/yy')
                                return (ReqDate.getUTCMonth()+1) + "/" + ReqDate.getUTCDate() + "/" + ReqDate.getUTCFullYear();
                              else
                                return ReqDate.getUTCDate() + "/" + (ReqDate.getUTCMonth()+1) + "/" + ReqDate.getUTCFullYear();
                             } 
                            }
                          else if (type === 'sort') { 
                           if((typeof source.Requested_Effective_Date__c == 'undefined') || source.Requested_Effective_Date__c == null)
                              return '';
                            else 
                              return new Date(source.Requested_Effective_Date__c);
                          }
                          return source.Requested_Effective_Date__c;
                    }
                    },
                    { "aTargets":[ "end" ],"mData": "Requested_Expiration_Date__c",
                    "mData": function ( source, type, val ) {
                          if (type === 'set') {
                              return;
                          }
                          else if (type === 'display' || type == 'filter') {
                            if((typeof source.Requested_Expiration_Date__c == 'undefined') && source.Requested_Expiration_Date__c == null)
                              return '';
                            else 
                             {var ReqDate = new Date(source.Requested_Expiration_Date__c);
                              if('{!DateFormat}' == 'mm/dd/yy')
                                return (ReqDate.getUTCMonth()+1) + "/" + ReqDate.getUTCDate() + "/" + ReqDate.getUTCFullYear();
                              else
                                return ReqDate.getUTCDate() + "/" + (ReqDate.getUTCMonth()+1) + "/" + ReqDate.getUTCFullYear();
                             }
                             }
                          else if (type === 'sort') { 
                           if((typeof source.Requested_Expiration_Date__c == 'undefined') || source.Requested_Expiration_Date__c == null)
                              return '';
                            else 
                              return new Date(source.Requested_Expiration_Date__c);
                          }
                          return source.Requested_Expiration_Date__c;
                    }
                    },
                    { "aTargets":[ "vol" ],"mData": "Volume__c"},
                    { "aTargets":[ "voluom" ],"mData": "Requested_UoM__c" },
                    { "aTargets":[ "price" ],"mData": "Price__c",
                    "mData": function ( source, type, val ) {
                          if (type === 'set') {
                              return;
                          }
                          else if (type === 'display' || type == 'sort' || type == 'filter') { 
                             if(source.Price__c == '' || source.Price__c == null || typeof source.Price__c == 'undefined')
                               return;
                             else
                             return source.CurrencyIsoCode + ' ' + source.Price__c.toFixed(4);
                          }
                          return source.Price__c;
                      } },
                    { "aTargets":[ "priceuom" ],"mData": "Requested_Price_UoM__c"},
                    { "aTargets":[ "freight" ],"mData": "Freight_Terms__c" },                    
                    { "aTargets":[ "TPI" ], 
                      "mData": function ( source, type, val ) {
                          if (type === 'set') {
                              return;
                          }
                          else if (type === 'display') { 
                            if((typeof source.TPI__c == 'undefined') || source.TPI__c == null)
                              return '';
                            else 
                              return (source.TPI__c + '%');
                          }
                          return source.TPI__c;
                      }
                    },
                    { "aTargets":[ "Inner_Table" ],"mData": "Inner_Table__c", sWidth:"2px", "bVisible":false}
                    
                    
             ]

});


}

function fnFormTableQuote(){
           $('#formtable').dataTable({
            "bJQueryUI":true,
            "fnCreatedRow": function( nRow, aData, iDataIndex ) {
                                $('td:eq(0)', nRow).html( '<img class="details_img" src="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/images/details_open.png')}">' );
                                fnSetImgListener(nRow, 'formtable');
            },
            "aoColumnDefs": [
                                { "aTargets":[ "Approval_Status" ], "mData": "Approval_Status__c" },
                                { "aTargets":[ "level" ],"mData": "Approval_Level__c"},
                                { "aTargets":[ "appr" ],"mData": "Approver__r.Name" },
                                { "aTargets":[ "type" ],"mData": "Type__c" },
                                { "aTargets":[ "CM" ],"mData": "CM_Percent__c" },
                                { "aTargets":[ "Unit_CM" ],"mData": "Unit_Contribution_Margin__c" },
                                { "aTargets":[ "sold" ],"mData": "SAP_SoldTo_Account__c" },
                                { "aTargets":[ "ship" ],"mData": "SAP_ShipTo_Account__c" },
                                { "aTargets":[ "mat" ],"mData": "SAP_Material__r.Name" },
                                { "aTargets":[ "start" ], 
                                  "mData": function ( source, type, val ) {
                                      if (type === 'set') {
                                          return;
                                      }
                                      else if (type === 'display') { 
                                        if (source.Requested_Effective_Date__c != '' && source.Requested_Effective_Date__c != null){
                                             var CSPDate = new Date(source.Requested_Effective_Date__c);
                                             if('{!DateFormat}' == 'mm/dd/yy')
                                                return (CSPDate.getUTCMonth()+1) + "/" + CSPDate.getUTCDate() + "/" + CSPDate.getUTCFullYear();
                                              else{
                                                return CSPDate.getUTCDate() + "/" + (CSPDate.getUTCMonth()+1) + "/" + CSPDate.getUTCFullYear();
                                              }
                                             }
                                        else return '';
                                        
                                      }
                                      else if (type === 'filter') {  return source.Requested_Effective_Date__c; }
                                      else if (type === 'sort') { 
                                       if((typeof source.Requested_Effective_Date__c == 'undefined') || source.Requested_Effective_Date__c == null)
                                          return '';
                                        else 
                                         return new Date(source.Requested_Effective_Date__c);
                                      }
                                      return source.Requested_Effective_Date__c;
                                  }
                                },
                                { "aTargets":[ "end" ], sClass:"Requested_Expiration_Date__c",sWidth:"2px", "bAutoWidth": false,
                                      "mData": function ( source, type, val ) {
                                          if (type === 'set') {
                                              return;
                                          }
                                          else if (type === 'display') { 
                                            if (source.Requested_Expiration_Date__c != '' && source.Requested_Expiration_Date__c != null){
                                                 var CSPDate = new Date(source.Requested_Expiration_Date__c);
                                                 if('{!DateFormat}' == 'mm/dd/yy')
                                                    return (CSPDate.getUTCMonth()+1) + "/" + CSPDate.getUTCDate() + "/" + CSPDate.getUTCFullYear();
                                                  else{
                                                    return CSPDate.getUTCDate() + "/" + (CSPDate.getUTCMonth()+1) + "/" + CSPDate.getUTCFullYear();
                                                  }
                                                 }
                                            else return '';
                                            
                                          }
                                          else if (type === 'filter') {  return source.Requested_Expiration_Date__c; }
                                          else if (type === 'sort') { 
                                           if((typeof source.Requested_Expiration_Date__c == 'undefined') || source.Requested_Expiration_Date__c == null)
                                              return '';
                                            else 
                                             return new Date(source.Requested_Expiration_Date__c);
                                          }
                                          return source.Requested_Expiration_Date__c;
                                      }
                                },
                                { "aTargets":[ "vol" ],"mData": "Volume__c"},
                                { "aTargets":[ "voluom" ],"mData": "Requested_UoM__c" },
                                { "aTargets":[ "price" ],"mData": "Price__c" },
                                { "aTargets":[ "priceuom" ],"mData": "Requested_Price_UoM__c"},
                                { "aTargets":[ "freight" ],"mData": "Freight_Terms__c" },  
                                { "aTargets":[ "TPI" ],
                                "mData": function ( source, type, val ) {
                                  if (type === 'set') { return;}
                                  else if (type === 'display') { 
                                    if((typeof source.TPI__c == 'undefined') || source.TPI__c == null)
                                      return '';
                                    else 
                                      return (source.TPI__c + '%');
                                  }
                                  return source.TPI__c;
                                  }
                                },
                                { "aTargets":[ "Inner_Table" ],"mData": "Inner_Table__c", sWidth:"2px", "bVisible":false}
                         ]
            
            });



}

function flagUncheck(){
CMflag = false;
}

function fnSimulate(){
                    $('#CompetitorsFrame').attr('data-submitted', 'submitted');
                                        
                    if($('#psr').val() == 'psr'){
                    $('#SupplierFrame').attr('data-submitted', 'submitted');
                    $('#PlantFrame').attr('data-submitted', 'submitted');}
                    
                    $('#operation').val('simulate');
                    $('#displaymsg').empty();
                    
                    if($('#freight').length){
                    var freightval = $('#freight').combobox('getText');
                    $('#freightval').val(freightval); }
                   
                    if(fnValidateCreateForm() == true){
                        $('#createform').ajaxSubmit({  
                        dataType:  'json', 
                        beforeSubmit: beforeSubmit
                    });
                    
                    $('#SaveSubmit').linkbutton('enable');
                    }
}

function fnSimulateCM(){
    CMflag = true;
    
    if(fnValidateCreateForm() == true){
    fnShowFog();
    fnSimulate();
    $('#displaymsg').empty();
    var itemText = '';
    itemText = '<b>Simulated with CM</b>';
    $('#displaymsg').html(itemText);
   }
   
}

function fnDisablefilter(type){
    $('#'+type).find('.dateinputfrom, .dateinputto, .numberinputfrom, .numberinputto, .textinput, .selectinput, .input').attr('disabled','disabled');
    
    $('#'+type+'_filter').find('input').attr('disabled','disabled');  
    
    }
    

function fnEnablefilter(type){
    $('#'+type).find('.dateinputfrom, .dateinputto, .numberinputfrom, .numberinputto, .textinput, .selectinput, .input').removeAttr('disabled');
    $('#'+type+'_filter').find('input').removeAttr('disabled');  
}

function fnCancel(type){  
     if(type == 'price_maintenance'){        
         $('#loadtarget').empty();
     }
     else
         $('#loadtarget2').empty();
     
     fnEnablefilter(type);
      
}

function fnResetAllFilters(oTable) {
    var oSettings = oTable.fnSettings();
   
    for(iCol = 0; iCol < oSettings.aoPreSearchCols.length; iCol++) {
        oSettings.aoPreSearchCols[ iCol ].sSearch = '';
    }
    oSettings.oPreviousSearch.sSearch = '';
         
    oTable.find('.dateinputfrom, .dateinputto, .numberinputfrom, .numberinputto, .textinput, .selectinput').each(function(){
    $(this).val(''); 
   }); 
   
     
    oTable.fnDraw();
}

/*adding for rfq form */
function fnSaverfq(){ 
                    
                    fnShowFog();  
                    $('#CompetitorsFrame').attr('data-submitted', 'submitted');
                    $('#operation').val('savesubmitrfq');
                    if(fnValidateCreateFormrfq() == true){
                   
                    $('#createformrfq').ajaxSubmit({  
                        dataType:  'json', 
                        beforeSubmit: beforeSubmitrfq
                    });
                    } 
}

function fnValidateCreateFormrfq(){
  
  var isValid;
  
  if($('#pacCode').combobox('getValue') == ''){
    $('#pacCodeFrame').addClass('error');
    $('#pacCodeError').html('This field is required.');
  
  }
  else {
    $('#pacCodeFrame').removeClass('error');
    $('#pacCodeError').html('');
  }
  
  if($('#Competitors').combobox('getValue') != '')
  { $('#CompetitorsFrame').removeClass('error');
    $('#CompetitorsError').html('');
  }
  else
  { $('#CompetitorsFrame').addClass('error');
    $('#CompetitorsError').html('This field is required.');
  }
 
  if($("#createformrfq").valid() == true && $('#Competitors').combobox('getValue') != '' &&  $('#pacCode').combobox('getValue') != '')
     return true;
      
     
  else
  {  fnHideFog(); 
     return false;
  }

}

function beforeSubmitrfq(formData, jqForm, options){
  $(formData).each(function(i, data){ 
             
           if(data.name == 'effdate')
             data.value = Date.parse($('#edate').datepicker('getDate'));
           if(data.name == 'exdate')
             data.value = Date.parse($('#exdate').datepicker('getDate'));
        });
   
  fnProcessFormrfq(formData);
  return false;
}

function fnProcessFormrfq(formData){
  
var oTable = $('#price_maintenance').dataTable();
                  var sData = new Array();
                  oTable.$('input:checked').each(function(i, sel){ sData.push($(sel).val()); });
                  
                  Nexprice.SubmitFormrfq(sData, formData, $('#operation').val(), function(result, event){
                     
                      if(event.type == 'exception') {
                         alert(event.message);
                         $('#Reset').click();
                         fnHideFog();      
                      }else { 
                       
                         fnRefreshTable_prospectMaterial();
                         if(sData.length > result.length)
                           alert('Some Transactions were already pending and can not be simulated.');
                      }
                       
                  }, {buffer: true, escape: true, timeout:120000});
                 
}

/*rfq form ends */


function fnSave(){ 
                    
                    $('#SaveSubmit').linkbutton('disable');
                    fnShowFog();
                    $('#CompetitorsFrame').attr('data-submitted', 'submitted');
                    
                    if($('#psr').val() == 'psr'){
                    
                    $('#SupplierFrame').attr('data-submitted', 'submitted');
                    $('#PlantFrame').attr('data-submitted', 'submitted');}
                    
                    $('#operation').val('savesubmit');
                    if(fnValidateCreateForm() == true){
                    var oTable1 = $('#quotetable').dataTable();
                    $(".SelectedAudit").each(function(i, v){
                    if($(this).attr("checked") == "checked")
                    {   var nTr = this.parentNode.parentNode;
                        aData = oTable1.fnGetData( nTr );
                    }});

                    
                    
                        $('#createform').ajaxSubmit({  
                                dataType:  'json', 
                                    beforeSubmit: beforeSubmit
                        });
                    
                     
                    } 
                    
           
}


function fnRefreshTable(){
                   
                    var oTable = $('#price_maintenance').dataTable();   
                    var aasIds = new Array();
                    var aaiDisplayMaster = new Array();
                    $('#price_maintenance').find('tr').has('input:checked').each(
                       function(i, e){ 
                          aasIds.push(oTable.fnGetData(e).Id);
                          aaiDisplayMaster.push(oTable.fnGetPosition(e)); 
                       });
                    
                    Nexprice.getPricing( aaiDisplayMaster, aasIds, function(result, event){   
                        
                        if(event.type == 'exception') {
                        alert('getPricing: ' + event.message);
                        fnHideFog();

                          } else { 
                               
                              for(var j=0; j<result.length; j++)
                              {

                              var nTR = $('#price_maintenance').dataTable().fnGetNodes(aRecordIds[result[j].Id]);
                              
                              var ss = oTable.fnUpdate(result[j], nTR );  

                              $('td:eq(' + aColumnIndex['Open'] + ')', nTR).html( '<img class="details_img" src="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/images/details_open.png')}">' );
                              fnSetImgListener(nTR, 'price_maintenance');
                              if(result[j].Has_Open_PRT__c == true || result[j].Has_Unit_Options__c == false)
                                      $('td:eq(' + aColumnIndex['Select'] + ')', nTR).html( '<input class="select_row" type="checkbox", value="' + result[j].Id + '" disabled="disabled">' );
                              else
                                      $('td:eq(' + aColumnIndex['Select'] + ')', nTR).html( '<input class="select_row" type="checkbox", value="' + result[j].Id + '">' );
                              
                              fnSetCheckboxListener(nTR, oTable);
                              $('#loadtarget').empty();
                              
                              fnEnablefilter('price_maintenance');
                              fnHideFog();
                              }     
                                 
                         }  
                    }, {buffer: false, escape: true, timeout:120000});
                    $('#loadtarget2').empty();
                 
    }
    
function fnRefreshTable_prospectMaterial(){
                    var oTable = $('#price_maintenance').dataTable();   
                    var aasIds = new Array();
                    var aaiDisplayMaster = new Array();
                    $('#price_maintenance').find('tr').has('input:checked').each(
                       function(i, e){ 
                          aasIds.push(oTable.fnGetData(e).Id);
                          aaiDisplayMaster.push(oTable.fnGetPosition(e)); 
                       });
                    
                    Nexprice.getProspectMaterial( aaiDisplayMaster, aasIds, function(result, event){   
                        
                        if(event.type == 'exception') {
                        alert('getProspect: ' + event.message);
                        fnHideFog();

                          } else { 

                              for(var j=0; j<result.length; j++)
                              {

                              var nTR = $('#price_maintenance').dataTable().fnGetNodes(aRecordIds[result[j].Id]);
                               
                              var ss = oTable.fnUpdate(result[j], nTR );  

                              $('td:eq(' + aColumnIndex['Open'] + ')', nTR).html( '<img class="details_img" src="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/images/details_open.png')}">' );
                              fnSetImgListener(nTR, 'price_maintenance');
                              if(result[j].Has_Open_PRT__c == true)
                                      $('td:eq(' + aColumnIndex['Select'] + ')', nTR).html( '<input class="select_row" type="checkbox", value="' + result[j].Id + '" disabled="disabled">' );
                              else
                                      $('td:eq(' + aColumnIndex['Select'] + ')', nTR).html( '<input class="select_row" type="checkbox", value="' + result[j].Id + '">' );
                              
                              fnSetCheckboxListener(nTR, oTable);
                              $('#loadtarget').empty();
                              $('#loadtarget2').empty();
                              fnEnablefilter('price_maintenance');
                              fnHideFog();
                              }     
                                 
                         }  
                    }, {buffer: false, escape: true, timeout:120000});
                 
}
    
function fnValidateCreateForm(){
  
  var isValid;
 
  if($('#datatable').val() == 'price_maintenance' && $('#pricetype').combobox('getValue') == 'RFQ'){
  
  if($('#pacCode').combobox('getValue') == ''){
    $('#pacCodeFrame').addClass('error');
    $('#pacCodeError').html('This field is required.');
  
  }
  else {
    $('#pacCodeFrame').removeClass('error');
    $('#pacCodeError').html('');
    }
   } 
    
  
  if($('#Competitors').combobox('getValue') != '')
  { $('#CompetitorsFrame').removeClass('error');
    $('#CompetitorsError').html('');
  }
  else
  { $('#CompetitorsFrame').addClass('error');
    $('#CompetitorsError').html('This field is required.');
  }
  
  if($('#psr').val() == 'psr'){
  
      if($('#CUPS').combobox('getValue') == 'N'){
          if($('#sapplant').combobox('getValue') != '')
          { $('#PlantFrame').removeClass('error');
            $('#PlantError').html('');
          }
          else
          { $('#PlantFrame').addClass('error');
            $('#PlantError').html('This field is required.');
          }
          
          if($('#psrfreight').combobox('getValue') != '')
          { $('#psrFreightFrame').removeClass('error');
            $('#psrFreightError').html('');
          }
          else
          { $('#psrFreightFrame').addClass('error');
            $('#psrFreightError').html('This field is required.');
          }
          
          if($('#sapplant').combobox('getValue') == '' || $('#psrfreight').combobox('getValue') == '')
              return false;
      
      }
      
  }
    if($('#datatable').val() == 'quotetable'){
        var oTable = $('#quotetable').dataTable();
        $(".SelectedAudit").each(function(i, v){
            if($(this).attr("checked") == "checked")
            { 
               var nTr = this.parentNode.parentNode;
               aData = oTable.fnGetData( nTr );
            }      
        });
        
        if(aData.Type__c != 'Quote'){ 
            if($("#createform").valid() == true && $('#Competitors').combobox('getValue') != '' && $('#pacCode1').combobox('getValue') != ''){
                
                    return true;
            }
        }
        else {
            if($("#createform").valid() == true && $('#Competitors').combobox('getValue') != '' ){
                
                    return true;
            }
        
        }
      
    }
    
    else if($('#datatable').val() == 'price_maintenance' && $('#pricetype').combobox('getValue') == 'RFQ'){
        if($("#createform").valid() == true && $('#Competitors').combobox('getValue') != '' && $('#pacCode').combobox('getValue') != ''){
            return true;
        }
    }
    else if($('#datatable').val() != 'quotetable' && $('#pricetype').combobox('getValue') != 'RFQ'){
        if($("#createform").valid() == true && $('#Competitors').combobox('getValue') != ''){
            return true;
        }
    }
    else if($('#datatable').val() == 'price_maintenance' && $('#psr').val() == 'psr'){
    if($("#createform").valid() == true){
              return true;}  
   }  
  else
  {  fnHideFog(); 
     return false;
  }

}
function beforeSubmit(formData, jqForm, options){
  $(formData).each(function(i, data){ 
  
           if(data.name == 'effdate')
             data.value = Date.parse($('#edate').datepicker('getDate'));
           if(data.name == 'exdate')
             data.value = Date.parse($('#exdate').datepicker('getDate'));
           if(data.name == 'effdatenext')
             data.value = Date.parse($('#edatenext').datepicker('getDate'));
           if(data.name == 'exdatenext')
             data.value = Date.parse($('#exdatenext').datepicker('getDate')); 
           if(data.name == 'psreffdate')
             data.value = Date.parse($('#psreffdate').datepicker('getDate'));
           if(data.name == 'psrexpdate')
             data.value = Date.parse($('#psrexpdate').datepicker('getDate'));
           
        });
        
  fnValidateStartDate(formData); 
  return false;
}

function fnValidateStartDate(formData)
{
    oTable = $('#formtable').dataTable();
    oTable.fnClearTable();
    
    if($('#formtype').val() == 'adjust' && $('#operation').val() == 'simulate'){
    var datatable = $('#datatable').val();
    var oTable = $('#'+datatable).dataTable();
    var sData = new Array();
    
    oTable.$('input:checked').each(function(i, sel){ sData.push($(sel).val()); });
    
        Nexprice.ValidateStartDate(sData, formData, $('#operation').val(), function(result, event){
        if(event.type == 'exception') 
            alert(event.message);
        else{ 
            if(result == false)
            {   alert('No valid pricing during start date of this request.');
               $('#SaveSubmit').linkbutton('disable');}
            else
                fnProcessForm(formData);
            }
             }, {buffer: true, escape: true, timeout:120000});
     }
     else
         fnProcessForm(formData);
}


function fnProcessForm(formData){
var datatable = $('#datatable').val();
var oTable = $('#'+datatable).dataTable();
var oTable2;
var sforcecheck;
                  var sData = new Array();
                  oTable.$('input:checked').each(function(i, sel){ sData.push($(sel).val()); });
                  
                  if(typeof sforce.one == 'undefined')
                      sforcecheck = false;
                  else 
                      sforcecheck = true;
                  
                      
                  if(datatable == 'price_maintenance'){
                  Nexprice.SubmitForm12(sforcecheck, navigator.userAgent, sData, formData, $('#operation').val(), CMflag, function(result, event){
                     oTable2 = $('#formtable').dataTable();
                     oTable2.fnClearTable();
                      if(event.type == 'exception') {

                      alert(event.message);
                      $('#Reset').click();
                      fnHideFog();      
                      } else { 
                      if($('#operation').val() != 'simulate')
                      {  fnRefreshTable();
                          CMflag = false;
                         if(sData.length > result.length)
                           alert('Some Transactions were already pending and can not be simulated.');
                      }else{
                         if(sData.length > result.length)
                           alert('Some Transactions were already pending and can not be simulated.');     
                           
                         if(result[0].TPI_below_threshold__c == true){
                                 alert('TPI is below 10% or above 200%. Please check the UoMs.');
                              }

                      }
                      
                      if(result.length > 0){
                           oTable2.fnAddData(result);  
                          
                            }
                        fnHideFog();
                       }
                  }, {buffer: true, escape: true, timeout:120000});
                  }
                  else{
                  
                  
                      Nexprice.SimulateForm(sData, formData, $('#operation').val(),$('#opt').val(),$('#sap_material').val(), CMflag, function(result, event){      
                          oTable2 = $('#formtable').dataTable();
                          oTable2.fnClearTable();
                          if(event.type == 'exception') {
    
                              alert(event.message);
                              $('#Reset').click();
                              fnHideFog();      
                          } else { 
                              
                              if($('#operation').val() != 'simulate')
                              {  
                                 CMflag = false;
                                 fnRefreshTable();
                                 if(sData.length > result.length)
                                   alert('Some Transactions were already pending and can not be simulated.');
                              }
                              if($('#operation').val() != 'savesubmit'){
                              if(result.length > 0){

                                   oTable2.fnAddData(result);  }
                                 }fnHideFog();
                           }
                          
                           }, {buffer: true, escape: true, timeout:120000});
                  }
                  
                  
}
function fixEscapedHTML(html, fieldid) {
  var value = $("<div />").html(html).text();
  setTimeout(function(){
      $('#' + fieldid).combogrid('textbox').val(value);
}, 10)
}
function processSerialize($form, options){
  $('#existingids').val($('#price_maintenance').dataTable().fnGetColumnData(aColumnIndex['Id']).join('-'));
}

function startSearch(formData, jqForm, options){

  fnShowFog();
  var existingids =  $('#price_maintenance').dataTable().fnGetColumnData(aColumnIndex['Id'], true, false, true);
  fnClearTable();
  existingids = new Array();

    Nexprice.getData(existingids ,formData, '{!$Setup.nexPrice_Settings__c.Salesforce_Limit_Per_Call__c}', '0', function(result, event){ 
          if(event.type == 'exception') {
            
            $('#Reset').click();
            fnHideFog();               
            } else {
             if(result.rows.length > 0){

                if(result.rows.length == 0)
                  fnHideFog();
                else
                fnAddData(result.rows, $('#price_maintenance').dataTable());
                $('#submitsearch').find('.ui-button-text').html('Search');
                onChangeMultiPage(formData);
                fnCalcPages();
              }
              else
              { fnHideFog(); 

              }
            }
   }, {buffer: true, escape: true, timeout:120000});
  
  return false;
}
function fnCalcPages(){
Nexprice.getDataCount($('#mimipanel').serializeArray(), function(result, event){ 
              if(event.type == 'exception') {
                
                alert(event.message);         
                } else { 
                var pages = result / {!$Setup.nexPrice_Settings__c.Salesforce_Record_Limit__c}
                var pageoptions = '';

                
                
                $('#submitsearch').button('disable');

                $('#submitsearch').attr('data-status', 'disable');
                 $('#pageselect').find('.ui-button-text').html('Show More (' + (Math.ceil(pages)-1) + ')');
                if(pages > 1)
                  $('#pageselect').attr('data-status', 'enable');
                else
                  $('#pageselect').attr('data-status', 'disable');
                $('#pageselect').attr('data-pages', Math.ceil(pages));
                $('#pageselect').attr('data-page', 1);
                }
             }, {buffer: true, escape: true, timeout:120000});
}
function fnHideFog(){
  $('#loadingbanner').hide();
  if($('#submitsearch').attr('data-status') == 'enable')
    $('#submitsearch').button('enable');
  if($('#pageselect').attr('data-status') == 'enable')
    $('#pageselect').button('enable'); 
  $('#clearsearch').button('enable'); 
  
}
function fnShowFog(){
  $('#loadingbanner').show();
  $('#submitsearch, #clearsearch, #pageselect').button('disable');
}
function onChangeMultiPage(formData){

$('#pageselect').click(function(){
                 
                 var existingids =  $('#price_maintenance').dataTable().fnGetColumnData(aColumnIndex['Id'], true, false, true);

                 fnShowFog();
                 var pages = parseInt($('#pageselect').attr('data-pages'));
                 var page = parseInt($('#pageselect').attr('data-page')) + 1;
                 var remainder = Math.ceil(pages - page);
                 
                 $('#pageselect').attr('data-page', page);
                 if(parseInt($('#pageselect').attr('data-page')) <= parseInt($('#pageselect').attr('data-pages')))
                 {
                 if(parseInt($('#pageselect').attr('data-page')) == parseInt($('#pageselect').attr('data-pages')))
                 {  $('#pageselect').button('disable');
                    $('#pageselect').attr('data-status', 'disable');
                    var tot = {!$Setup.nexPrice_Settings__c.Salesforce_Limit_Per_Call__c} * pages;
                    $('#countbannermessage').html('All records matching the filter criteria have been added to the list. Click Clear Search to start a new search.');
                 }
                 $('#pageselect').attr('data-page', page)
                 $('#pageselect').find('.ui-button-text').html('Show More (' + remainder + ')');
                 var off = {!$Setup.nexPrice_Settings__c.Salesforce_Limit_Per_Call__c} * (page-1);

                 Nexprice.getData(existingids ,formData, '{!$Setup.nexPrice_Settings__c.Salesforce_Limit_Per_Call__c}', off.toString() , function(result, event){ 
                          if(event.type == 'exception') {
                           fnHideFog();
                           alert('GetData: ' + event.message)
                           $('#Reset').click();   
                          } else {

                            if(result.length == 0)
                              fnHideFog();
                            else
                            fnAddData(result.rows, $('#price_maintenance').dataTable());  
                          } 
                      }, {buffer: true, escape: true, timeout:120000});
                }
  });

}
function processJson(data) {
    fnAddData(data, $('#price_maintenance').dataTable());
}

function fnLoadcounter()
{
    var arr = new Array();
    arr.push('{!$User.Id}');
    
    Nexprice.fetchPendingWithSeller(3,arr,function(result, event){
        if(event.type != 'exception') 
       {
            showCounter(result.length);}
        },{buffer: true, escape: true, timeout:120000});    
}
function showCounter(numbr)
{
    var tab = $('#main').tabs('getTab', 3);  
        
    $('#main').tabs('update', {
        tab: tab,
        options: {
            title: 'Rejected with Alternate ('+numbr+')'
        }
    }); 
}
function fnFormatDetails( nTr, type )
{
   var aData = $('#' + type).dataTable().fnGetData( nTr);
   var toreturn = '';

   var selectedTabTitle;
   var tab;
   tab = $('#main').tabs('getSelected');
   selectedTabTitle = $('#main').tabs('getTabIndex',tab);
   

   if(type == 'price_maintenance')
   toreturn = $("<div />").html(aData.Inner_Table__c).text();
   else if(type == 'formtable' && selectedTabTitle != 1)
   toreturn = $("<div />").html(aData.Simulate_Table__c).text();
   else if(type == 'formtable' && selectedTabTitle == 1)
   toreturn = $("<div />").html(aData.Inner_Table__c).text();
   else if(type == 'audittable')
   toreturn = $("<div />").html(aData.Inner_Table__c).text();
   else if(type == 'quotetable')
   toreturn = $("<div />").html(aData.Inner_Table__c).text();
   else if(type == 'pendingtable')
   toreturn = $("<div />").html(aData.Inner_Table__c).text();
   else if(type == 'rejectalternate')
   toreturn = $("<div />").html(aData.Inner_Table_For_Seller__c).text();
   
   return toreturn;
}
function fnInitPage(){ 
var selectedTabTitle;
var tab;
$('.showhide').click(function(){
    var oTable = $('#price_maintenance').dataTable();
    oTable.fnSetColumnVis( aColumnIndex[$(this).attr('name')], $(this).prop('checked'));
    oTable.fnDraw();
});


$('#clearsearch').click(function(){ 
 fnClearTable();
 fnCancel('price_maintenance');
 $('#pageselect').find('.ui-button-text').html('Show More (0)');
 $('#pageselect').button('disable');
 $('#pageselect').attr('data-status', 'enable');
 $('#submitsearch').button('enable');
 $('#submitsearch').attr('data-status', 'enable');
 $(".mselect").each(function(i, sel){
 var sName = $(sel).attr('data-name');
 
   $(sel).multiselect("widget").find(":checkbox").each(function(){
     if($(this).prop('checked'))
       this.click();  
   });
  
 if(sName == 'Sold To' || sName == 'Ship To' || sName == 'Material' || sName == 'Base Code' || sName == 'Corporate')
      $(sel).empty();
  
   $(sel).multiselect('refresh');
   $(sel).multiselect('widget').find('input').val('');
   
 });
   
   $('#price_maintenance').find('.textinput, .selectinput').each(function(i, ti){ $(this).val($(this).attr('name')); 
       $('#price_maintenance').dataTable().fnFilter('', aColumnIndex[$(this).attr('data-field')]);
       $(this).val(''); 
   });
   
   $('#price_maintenance').find('.dateinputfrom, .dateinputto, .numberinputfrom, .numberinputto').each(function(){
       $(this).val(''); 
   }); 
   
   $('#price_maintenance').dataTable().fnDraw();
   
   refreshCount();
 });
 
   if('{!$CurrentPage.parameters.id}' != '')
   Nexprice.getAccount('{!$CurrentPage.parameters.id}', function(result, event){ 
        
                 var opt1 = '<option selected="selected" value="' + result.SAP_Corporate_Account_Id__c + '">' + result.SAP_Corporate_Account__c + '</option>';
                 var opt2 = '<option selected="selected" value="' + result. SAP_Sold_To_Account_Id__c + '">' + result.SAP_Sold_To_Account__c + '</option>';
                 var opt3 = '<option selected="selected" value="' + result.Id + '">' + result.Name + ' - ' + result.AccountNumber + '</option>';
                 
                 if(typeof result.SAP_Partner_Functions__c == 'undefined' )
                 {  
                     $('.advanced').show();
                     $('#corp').empty();
                     $('#corp').append(opt3);
                     $('#corp').multiselect('refresh');
                     $('#corp').multiselect('widget').find('input').val('');
                        
                 }
                 else if(result.SAP_Partner_Functions__c == 'Ship To')
                 {
                     $('#shto').empty();
                     $('#shto').append(opt3);
                     $('#shto').multiselect('refresh');
                     $('#shto').multiselect('widget').find('input').val('');
                 }
                 else 
                 {
                     $('#sldto').empty();
                     $('#sldto').append(opt2);
                     $('#sldto').multiselect('refresh');
                     $('#sldto').multiselect('widget').find('input').val('');
                 }
                 
                 $('#mimipanel').submit();
                 refreshCount();
             }, {buffer: true, escape: true, timeout:120000});
             
             //else
             //refreshCount();
    
    $('#ph6').combobox({
          onSelect: function(param){
             Nexprice.FetchPH7($('#ph6').combobox('getValue'),function(result, event){
              if(event.type == 'exception') {
                 
                alert(event.message);   
              } else {      
                $('#ph7').combobox('destroy');    
                var phi7 = '<select class="mimiselect easyui-combobox" id = "ph7" style="width:225px;" data-label="Material_SubSegment__c" name="PH7__c" data-matfieldname="PH7_SubSegment__c" data-name="Subsegments" >';
                phi7 += $('<div/>').html(result).text() + '</select>';
                $('#ph7holder').append(phi7);
   
                $('#ph7').combobox();     
             }
          }, {buffer: true, escape: true, timeout:120000}); 
             
          }
        });
        $('#ph7').combobox();
        $('#ph7').combobox('disable');
    
    

    
 $('.advanced').hide();
 $('#mimi').click(function(){ 
 
 if( $('.advanced').is(':visible') == false)
 {
   $('.advanced').show();
   $("#shtoowners").multiselect("widget").find(":checkbox").each(function(){
    if( $(this).val() === '{!myEmpId}')
       this.click();
   });
   
   $("#materialtype").multiselect("widget").find(":checkbox").each(function(){
    if( $(this).val() === '{!defaults.Classification__c}')
       this.click();
   });
 }
 else
 { $(".mselect").each(function(i, sel){
   $(sel).multiselect("widget").find(":checkbox").each(function(){
     if($(this).prop('checked'))
       this.click();  
   });
  });
  $('.advanced').hide();
 }
});
 $.ech.multiselect.prototype.options.minWidth = "auto";
        $(".mselect").each(function(i, oSel){
           
           var m = $(oSel).multiselect({
            click: function(event, ui){
             $('#pageselect').find('.ui-button-text').html('Show More (0)');
             $('#pageselect').button('disable');
             $('#pageselect').attr('data-status', 'enable');
             $('#submitsearch').button('enable');
             $('#submitsearch').attr('data-status', 'enable');
            },
            close: function(event, ui){
                tab = $('#main').tabs('getSelected');
                selectedTabTitle = $('#main').tabs('getTabIndex',tab);
                
                if(selectedTabTitle == 0){
                    refreshCount();
     
                    if( $('#price_maintenance').dataTable().fnGetData().length > 0 )
                        $('#submitsearch').find('.ui-button-text').html('Search');
                }
                else if(selectedTabTitle == 1)
                {
                    fnGetQuotes();
                    if($('#UserLookup2').val() != null){
                    Nexprice.fetchPendingWithSeller(3,$('#UserLookup2').val(),function(result, event){
                        if(event.type != 'exception') 
                       {
                            showCounter(result.length);}
                        },{buffer: true, escape: true, timeout:120000});}
                    else{
                        showCounter(0);
                    }  
                }
                else if(selectedTabTitle == 2)
                {
                    fnGetPending(2);
                    if($('#UserLookup2').val() != null){
                    Nexprice.fetchPendingWithSeller(3,$('#UserLookup2').val(),function(result, event){
                        if(event.type != 'exception') 
                        {
                            showCounter(result.length);}
                        },{buffer: true, escape: true, timeout:120000});}
                    else{
                        showCounter(0);
                      }
                    
                }
                else if(selectedTabTitle == 3)
                {
                    fnGetPending(3);    
                }
                else if(selectedTabTitle == 4)
                {
                    fnGetAudit();
                    if($('#UserLookup2').val() != null){
                    Nexprice.fetchPendingWithSeller(3,$('#UserLookup2').val(),function(result, event){
                        if(event.type != 'exception') 
                        {
                            showCounter(result.length);}
                        },{buffer: true, escape: true, timeout:120000});}
                      else{
                          showCounter(0);
                         }
                }
            },
            noneSelectedText: $(this).attr('data-name'), 
            selectedText: $(this).attr('data-name') + ": # Selected"       
            }).multiselectfilter();

            var sName = $(oSel).attr('data-name');

            var oWidget = $(oSel).multiselect('widget');
   
            if(sName == 'Material' || sName == 'Base Code' || sName == 'Sold To' || sName == 'Ship To' || sName == 'Corporate')
            {         

              $(oWidget).find('.ui-widget-header').find('.ui-multiselect-filter').append('<img class="iClear" src="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/themes/icons/no.png')}"/>');  
              $(oWidget).find('.ui-widget-header').find('.ui-multiselect-filter').append('<img class="iSearch" src="{!URLFOR($Resource.spinner)}"/>');    
              
              $(oWidget).find('.iSearch').hide();
              $(oWidget).find('.iClear').click(function(){
              $(oSel).empty();
              $(oSel).multiselect('refresh');
              $(oWidget).find('input').val('');
              });
              
              $(oWidget).find('input').on('keydown', function(e){
                clearTimeout(timeout);
                if($(this).val().length > 1)
                   timeout = setTimeout(function(){fnInitSearchBox(oWidget, oSel, sName)},750);
               });
            }
       });
       
       <!-- Added for Account Material Change -->
  $(".singleselect").each(function(i, oSel){
           var m = $(oSel).multiselect({
           multiple: false,
           noneSelectedText: $(this).attr('data-name'), 
           selectedText: $(this).attr('data-name') + ": # Selected"       
           }).multiselectfilter();
           
           var sName = $(oSel).attr('data-name');
           var oWidget = $(oSel).multiselect('widget');
   
            if(sName == 'SAP Material' || sName == 'Account' || sName == 'RFQ Material')
            {         

              $(oWidget).find('.ui-widget-header').find('.ui-multiselect-filter').append('<img class="iClear" src="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/themes/icons/no.png')}"/>');  
              $(oWidget).find('.ui-widget-header').find('.ui-multiselect-filter').append('<img class="iSearch" src="{!URLFOR($Resource.spinner)}"/>');    
              
              $(oWidget).find('.iSearch').hide();
              $(oWidget).find('.iClear').click(function(){
              $(oSel).empty();
              $(oSel).multiselect('refresh');
              $(oWidget).find('input').val('');
              });
              
              $(oWidget).find('input').on('keydown', function(e){
              clearTimeout(timeout);
                  if($(this).val().length > 1)
                     timeout =setTimeout(function(){fnAccntMatSearchBox(oWidget, oSel, sName)},750);   
               });
            }
    });
    
     $(".amselect").each(function(i, oSel){
         var m = $(oSel).multiselect({
           noneSelectedText: $(this).attr('data-name'), 
           selectedText: $(this).attr('data-name') + ": # Selected"       
           }).multiselectfilter();
       });
 <!-- Code added for Account Material Change Ends -->
 

 $('#nextoolbar2').hide();


 $('#ClearFilters').click(function(){ 
   /*$('#price_maintenance').find('.textinput, .selectinput').each(function(i, ti){ $(this).val($(this).attr('name')); 
      $('#price_maintenance').dataTable().fnFilter('', aColumnIndex[$(this).attr('data-field')]);
      $(this).val(''); 
      
   });
   $('#price_maintenance').find('.dateinputfrom, .dateinputto, .numberinputfrom, .numberinputto').each(function(){
    $(this).val(''); 
    
   });
  
   $('#price_maintenance').dataTable().fnDraw(); */
    fnResetAllFilters($('#price_maintenance').dataTable());
   fnUpdateFilterSelect('price_maintenance', aColumnIndex);
 });
 
  $('#ClearFilters2').click(function(){ 
   var tab = $('#main').tabs('getSelected');
   var index = $('#main').tabs('getTabIndex',tab);
   if(index == 1){
       /*$('#quotetable').find('.textinput, .selectinput').each(function(i, ti){ $(this).val($(this).attr('name')); 
          $('#quotetable').dataTable().fnFilter('', aColumnIndex_Draft[$(this).attr('data-field')]);
          $(this).val(''); 
       });
       $('#quotetable').find('.dateinputfrom, .dateinputto, .numberinputfrom, .numberinputto').each(function(){
        $(this).val(''); 
       }); 
       $('#quotetable').dataTable().fnDraw();*/
       fnResetAllFilters($('#quotetable').dataTable()); 
       fnUpdateFilterSelect('quotetable', aColumnIndex_Draft);
       
   }
   if(index == 2){
       /*$('#pendingtable').find('.textinput, .selectinput').each(function(i, ti){ $(this).val($(this).attr('name')); 
          $('#pendingtable').dataTable().fnFilter('', aColumnIndex_Draft[$(this).attr('data-field')]);
          $(this).val(''); 
       });
       $('#pendingtable').find('.dateinputfrom, .dateinputto, .numberinputfrom, .numberinputto').each(function(){
        $(this).val(''); 
       }); 
       $('#pendingtable').dataTable().fnDraw();*/
       fnResetAllFilters($('#pendingtable').dataTable());
       fnUpdateFilterSelect('pendingtable', aColumnIndex_Draft);
   }
   if(index == 3){
       /*$('#rejectalternate').find('.textinput, .selectinput').each(function(i, ti){ $(this).val($(this).attr('name')); 
          $('#rejectalternate').dataTable().fnFilter('', aColumnIndex_Draft[$(this).attr('data-field')]);
          $(this).val(''); 
       });
       $('#rejectalternate').find('.dateinputfrom, .dateinputto, .numberinputfrom, .numberinputto').each(function(){
        $(this).val(''); 
       }); 
       $('#rejectalternate').dataTable().fnDraw();*/
       fnResetAllFilters($('#rejectalternate').dataTable());
       fnEvaluateTableRejectAlternate($('#rejectalternate' ).dataTable());
       fnUpdateFilterSelect('rejectalternate', aColumnIndex_Draft);
   }
   if(index == 4){
       /*$('#audittable').find('.textinput, .selectinput').each(function(i, ti){ $(this).val($(this).attr('name')); 
          $('#audittable').dataTable().fnFilter('', aColumnIndex_Draft[$(this).attr('data-field')]);
          $(this).val(''); 
       });
       $('#audittable').find('.dateinputfrom, .dateinputto, .numberinputfrom, .numberinputto').each(function(){
        $(this).val(''); 
       }); 
       $('#audittable').dataTable().fnDraw();*/
       fnResetAllFilters($('#audittable').dataTable());
       fnUpdateFilterSelect('audittable', aColumnIndex_Draft);
   }
   
 });

 $('#SelectAll').click(function(){ 

     $('#price_maintenance').find('input:checkbox').not('input[disabled="disabled"]').attr('checked', 'checked');
     fnEvaluateTable($('#price_maintenance' ).dataTable()); 
 });
 $('#SelectAll2').click(function(){ 

     var tab = $('#main').tabs('getSelected');
     var index = $('#main').tabs('getTabIndex',tab);
     if(index == 1)
         $('#quotetable').find('input:checkbox').not('input[disabled="disabled"]').attr('checked', 'checked');
     if(index == 2)
         $('#pendingtable').find('input:checkbox').not('input[disabled="disabled"]').attr('checked', 'checked');
     if(index == 3){
         $('#rejectalternate').find('input:checkbox').not('input[disabled="disabled"]').attr('checked', 'checked');
         fnEvaluateTableRejectAlternate($('#rejectalternate' ).dataTable());
     }   
 });
 $('#Reset').click(function(){ 

     $('#price_maintenance').find('input:checkbox').not('input[disabled="disabled"]').removeAttr('checked'); 
     fnEvaluateTable($('#price_maintenance' ).dataTable()); 
 });
  $('#Reset2').click(function(){ 

     var tab = $('#main').tabs('getSelected');
     var index = $('#main').tabs('getTabIndex',tab);
     if(index == 1)
         $('#quotetable').find('input:checkbox').not('input[disabled="disabled"]').removeAttr('checked'); 
     if(index == 2)
         $('#pendingtable').find('input:checkbox').not('input[disabled="disabled"]').removeAttr('checked'); 
     if(index == 3){
         $('#rejectalternate').find('input:checkbox').not('input[disabled="disabled"]').removeAttr('checked'); 
         fnEvaluateTableRejectAlternate($('#rejectalternate' ).dataTable());
     }
 });
 
 $('#approverejectChange').click(function(){
         if($('#mm21').menu('findItem', 'Approve/Reject').disabled == false){
             var oTable = $('#rejectalternate').dataTable();
             var sData = oTable.$('input').serialize();
             $('#apprids').val(sData);
             $('#dd').dialog('open');
         }
       });
       
   
 $('#dd').dialog({  
      title: 'Approve / Reject Change',  
      width: 475,  
      height: 325,  
      closed: true,  
      cache: false, 
      modal: true,
      toolbar:[{
            text:'Approve',
            iconCls:'icon-ok',
            handler:function(){ Nexprice.approveRejectChange($('#apprids').val(),$('#approvalcomments').val(),'Approve',function(result, event){ 
                                    if(event.type == 'exception') {
                                        
                                    } 
                            }, {buffer: true, escape: true, timeout:120000});
                            $('#dd').dialog('close');
                            $('#approvalcomments').val(''); 
                            $('#rejectalternate' ).dataTable().fnClearTable();
                            fnGetPending(3);
                            }
        },{
            text:'Reject',
            iconCls:'icon-cancel',
            handler:function(){ Nexprice.approveRejectChange($('#apprids').val(),$('#approvalcomments').val(),'Reject',function(result, event){ 
                                    if(event.type == 'exception') {
                                       
                                    } 
                            }, {buffer: true, escape: true, timeout:120000});
                            $('#dd').dialog('close'); 
                            $('#approvalcomments').val('');
                            $('#rejectalternate' ).dataTable().fnClearTable();
                            fnGetPending(3);
                            }
        }]
    });
    

<!-- added for prospect material chckbox -->
 

 $("#AM_add_Pros_Mat").change(function() {
        if($(this).is(":checked")) {
            $("#dmat").hide();
            $("#dd21").show();
            $("#AM_add_material").attr('disabled','disabled');

        }
        else
        {
            $("#dmat").show();
            $("#dd21").hide();
        }
 });

 $('#supplierlookup').combogrid({  
                panelWidth:200, 
                width:225, 
                value:'',    
                delay: 500,  
                idField:'Id',  
                textField:'Name', 
                required: false,
                keyHandler: {
                  query: function(q){
                          var g = $(this).combogrid('grid');
                          Nexprice.getsuppliers(function(result, event){
                            if(event.type == 'exception') {
                              error.apply(this, arguments);         
                            } else {      
                              g.datagrid('loadData', result);         
                            }
                          }, {buffer: true, escape: true, timeout:120000});
                   }
                },
                columns:[[  
                       {field:'Name',title:'Supplier',width:300} 
                ]],
                
                loader: function(param,success,error){
                     Nexprice.getsuppliers(function(result, event){
        
                     if(event.type == 'exception') {
                        error.apply(this, arguments);         
                     } else {      
                       success(result);         
                     }
                 }, {buffer: true, escape: true, timeout:120000});
                
                },
                onSelect: function(param){ fixEscapedHTML($('#supplierlookup').combogrid('getText'), 'supplierlookup');
                
                }    
  });
 
  $('#supplierlookup').combogrid('textbox').focusin(function(){ 
  $('#supplierlookup').combogrid('clear');
             });
  $('#supplierlookup').combogrid('setValue', $('#supplierlookup').attr('supplierlookup'));
  fixEscapedHTML($('#supplierlookup').attr('supplierlookup'), 'supplierlookup');                 
   
 $('#setprice').click(function(){
   if($('#mm1').menu('findItem', 'Create RFQ').disabled == false)
   {
     fnDisablefilter('price_maintenance');
     $('#loadtarget').empty();
     aSel = new Array();
     $('#price_maintenance').find('input:checked').each(function(i, sel){ aSel.push($(sel).val()); 
      
     });
     
     
     var oTable = $('#price_maintenance').dataTable();
     $(".select_row").each(function(i, v){
     if($(this).attr("checked") == "checked")
     {   var nTr = this.parentNode.parentNode;
         aData = oTable.fnGetData( nTr );
      }});
       var table = 'price_maintenance';  
       if(aSel.length > 0)
       {    
       if(aData.Prospect_Material__c == false)
                $('#loadtarget').load('/apex/Price_Request_Form?id=' + aSel.join('-') + '&opt=RFQ' , function() {
                
                fnInitForm(table); });
             else
                 $('#loadtarget').load('/apex/RFQ_form_without_material?id=' + aSel.join('-'), function() {
                fnInitForm(table);  });             
       }
   }
 });
 
 $('#adjust').click(function(){
   if($('#mm1').menu('findItem', 'Adjust Price').disabled == false)
   {
      
       fnDisablefilter('price_maintenance');
     $('#formtype').val('adjust');
     $('#loadtarget').empty();
     aSel = new Array();
     var table = 'price_maintenance';
     $('#price_maintenance').find('input:checked').each(function(i, sel){ aSel.push($(sel).val()); });
       if(aSel.length > 0)
         $('#loadtarget').load('/apex/Price_Request_Adjust_Form?id=' + aSel.join('-'), function() {
            fnInitForm(table);
         });
   }
 });
 
 $('#createquote').click(function(){
     if($('#mm1').menu('findItem', 'Create Quote').disabled == false)
     {
         fnDisablefilter('price_maintenance');
         $('#loadtarget').empty();
         aSel = new Array();
         $('#price_maintenance').find('input:checked').each(function(i, sel){ aSel.push($(sel).val()); 
      
         });
         var oTable = $('#price_maintenance').dataTable();
         $(".select_row").each(function(i, v){
         if($(this).attr("checked") == "checked")
         {   
             var nTr = this.parentNode.parentNode;
             aData = oTable.fnGetData( nTr );
         }});
         var table = 'price_maintenance';  
         if(aSel.length > 0)
         {    
       
             $('#loadtarget').load('/apex/Price_Request_Form?id=' + aSel.join('-') + '&opt=Quote', function() {
            
             fnInitForm(table); });
            
         }
         
     }
 });
 
 $('#createcsp').click(function(){
     if($('#mm1').menu('findItem', 'Set Price').disabled == false)
     {
         fnDisablefilter('price_maintenance');
         $('#loadtarget').empty();
         aSel = new Array();
         $('#price_maintenance').find('input:checked').each(function(i, sel){ aSel.push($(sel).val()); 
      
         });
         var oTable = $('#price_maintenance').dataTable();
         $(".select_row").each(function(i, v){
         if($(this).attr("checked") == "checked")
         {   
             var nTr = this.parentNode.parentNode;
             aData = oTable.fnGetData( nTr );
         }});
         CMflag = false;
         var table = 'price_maintenance';  
         if(aSel.length > 0)
         {    
       
             $('#loadtarget').load('/apex/Price_Request_Form?id=' + aSel.join('-') + '&opt=CSP', function() {
            
             fnInitForm(table); });
            
         }            
     }
 });
 
 
  $('#priceChange').click(function(){
     if($('#mm1').menu('findItem', 'Set Price').disabled == false)
     {
         fnDisablefilter('price_maintenance');
         $('#loadtarget').empty();
         aSel = new Array();
         $('#price_maintenance').find('input:checked').each(function(i, sel){ aSel.push($(sel).val());
      
         });
         var oTable = $('#price_maintenance').dataTable();
         $(".select_row").each(function(i, v){
         if($(this).attr("checked") == "checked")
         {   
             var nTr = this.parentNode.parentNode;
             aData = oTable.fnGetData( nTr );
         }});
         var table = 'price_maintenance';  
         if(aSel.length > 0)
         {    
       
             $('#loadtarget').load('/apex/Price_Request_Form_CSP?id=' + aSel.join('-') + '&opt=CSP', function() {
            
             fnInitForm(table); });
            
         }            
     }
 });
 

 
 $('#modifyrfq').click(function(){
    if($('#mm21').menu('findItem', 'Modify Request').disabled == false)
   {
      
     fnDisablefilter('quotetable');
     $('#loadtarget2').empty();
     aSel = new Array();
     CMflag = false;
     $('#quotetable').find('input:checked').each(function(i, sel){ aSel.push($(sel).val()); });
      
       if(aSel.length > 1)
       {
           alert('Modify Request is is allowed for only one record at a time.');
       }else{
             $('#loadtarget2').load('/apex/RFQ_Reject_Alternate_Form?ids=' + aSel.join('-') +'&opt=modify', function() {
               var table = 'quotetable';
         
           fnInitForm(table); 
          });}
   }
 });

$('#expirecsp').click(function(){
   if($('#mm1').menu('findItem', 'Expire CSP').disabled == false)
   {
       aSel = new Array();
         $('#price_maintenance').find('input:checked').each(function(i, sel){ aSel.push($(sel).val());  });
         
       var insert_PSIDs = new sforce.SObject("Price_Support_Ids__c"); 
       var ids = ""; 
       
            for(var i=0;i<aSel.length;i++) 
                    ids += aSel[i] +'-';    
            insert_PSIDs.Ids__c = ids;
            
            var result = sforce.connection.create([insert_PSIDs]);
            window.open('/apex/Expire_CSP?ids=' + result[0].id);
   }
 });


<!-- ****Added as "Remove CPI" Project 15th July 2014**** @Rajeev-->

$('#deletecsp').click(function(){
   if($('#mm1').menu('findItem', 'Remove CPI').disabled == false)
   {
       aSel = new Array();
         $('#price_maintenance').find('input:checked').each(function(i, sel){ aSel.push($(sel).val());  });
         
       var insert_PSIDs = new sforce.SObject("Price_Support_Ids__c"); 
       var ids = ""; 
       
            for(var i=0;i<aSel.length;i++) 
                    ids += aSel[i] +'-';    
            insert_PSIDs.Ids__c = ids;
            
            var result = sforce.connection.create([insert_PSIDs]);
            window.open('/apex/Delete_CSP?ids=' + result[0].id);
   }
 });

<!-- ****End of Remove CPI project**** -->

 
 $('#setpricerfq').click(function(){
if($('#mm1').menu('findItem', 'Create RFQ').disabled == false)
{    
     fnDisablefilter('price_maintenance'); 
     $('#loadtarget').empty();
     aSel = new Array();     
     $('#price_maintenance').find('input:checked').each(function(i, sel){ aSel.push($(sel).val()); });
     if(aSel.length > 0) 
     $('#loadtarget').load('/apex/RFQ_form_without_material?id=' + aSel.join('-'), function() {
         var table = 'price_maintenance';
         fnInitForm(table);
     });
}     
 });
 
 $('#createpsr').click(function(){
     if($('#mm1').menu('findItem', 'Create/Modify PSR').disabled == false)
     {
         Nexprice.getPermission(function(result, event){
                     if(event.type == 'exception') {
                         alert(event.message);            
                     } else {      
                       if(result == false)
                           alert('You are not authorized to use this function.');
                       else{
                                 fnDisablefilter('price_maintenance');
                                 fnpsr();
                                 var oTable = $('#price_maintenance').dataTable();
                                 $(".select_row").each(function(i, v){
                                 if($(this).attr("checked") == "checked")
                                 {   var nTr = this.parentNode.parentNode;
                                     aData = oTable.fnGetData( nTr );
                                  }});
                                 
                                 if(aData.Price_Support_Indicator__c == 'Yes')
                                     $('#psr').dialog('open'); 
                                 else{
                                     $('#loadtarget').empty();
                                     var aSel= new Array();
                                     $('#price_maintenance').find('input:checked').each(function(i, sel){ aSel.push($(sel).val()); });
                                     CMflag = false;
                                     var table = 'price_maintenance'; 
                                     $('#loadtarget').load('/apex/Price_Request_Form_with_PSR?id=' + aSel.join('-') + '&opt=CSP', function() {
                                     fnInitForm(table);
                                     fninitformpsr(); });
                                 } 
                             }}
         
         }, {buffer: true, escape: true, timeout:120000}); 
     }
 });  
 
 $('#psr').dialog({  
              title: 'Select Supplier',  
              width: 475,  
              height: 125, 
              closed: true, 
              cache: false, 
              modal: true,
              toolbar:[{
                    text:'Save',
                    iconCls:'icon-ok',
                    handler:function(){
                    var aSel= new Array();
                    $('#price_maintenance').find('input:checked').each(function(i, sel){ aSel.push($(sel).val()); });
                    var psId = $('#psrsupp').combogrid('getValue');
                    
                     if(psId == null || psId == ''){
                             alert('Please select the supplier.');
                         }
                         else{
                         $('#psr').dialog('close');
                         $('#loadtarget').empty();
                         CMflag = false;
                         var table = 'price_maintenance'; 
                         {   $('#loadtarget').load('/apex/Price_Request_Form_with_PSR?id=' + aSel.join('-') + '&opt=CSP&psId=' + psId, function() {
                             fnInitForm(table);
                             fninitformpsr(); });
                         } }    
                     }
                },{
                text:'Cancel',
                iconCls:'icon-cancel',
                handler:function(){
                $('#psr').dialog('close');
                $('#psrsupp').combogrid('clear');
                fnEnablefilter('price_maintenance');
                }
                }]   
            });

 $('#mimipanel').ajaxForm({  
        dataType:  'json', 
        beforeSubmit: startSearch,
        beforeSerialize: processSerialize 
    });
 $('#clearsearch, #submitsearch, #pageselect').button();
 $('#pageselect').button('disable');
 $('#pageselect').attr('data-status', 'disable');
 
 $('#main').tabs({  
        border:false,  
        onSelect:function(title, index){
          //$('#ClearFilters').click();
          fnResetAllFilters($('#price_maintenance').dataTable());
          $('#nextoolbar').hide();
          $('#nextoolbar2').hide();
          var item = $('#mm21').menu('findItem', 'Approve/Reject');
          var item4 = $('#mm21').menu('findItem', 'Release Quote');
          
          $('#mm21').menu('disableItem', item.target);
          $('#mm21').menu('disableItem', item4.target);
          
          if(index == 0)
          {   
            $('#nextoolbar').show();
          }
          if(index == 1)
          {
             fnResetAllFilters($('#quotetable').dataTable());  
             $('#nextoolbar2').show();
             fnGetQuotes();
             fnEvaluateTablePriceQuote($('#quotetable').dataTable());
          }
          if(index == 2)
          {
             fnResetAllFilters($('#pendingtable').dataTable());
             $('#nextoolbar2').show();
             fnGetPending(index);
          }
          if(index == 3)
          {
             fnResetAllFilters($('#rejectalternate').dataTable());
             $('#nextoolbar2').show();
             fnGetPending(index);
             fnEvaluateTableRejectAlternate($('#rejectalternate' ).dataTable());

          }
          if(index == 4)
          {
             fnResetAllFilters($('#audittable').dataTable());
             $('#nextoolbar2').show();
             fnGetAudit();
          }
                    
        }
 });

}

function fnpsr(){

 $('#psregion').combobox({editable:false});
 $('#psregion').combobox('setValue', $('#psregion').attr('data-value'));
 $('#psrsupp').combogrid({  
                panelWidth:200, 
                width:200, 
                delay: 500,  
                idField:'SAP_Price_Support__c',  
                textField:'Supplier_Name__c', 
                hasDownArrow: true,
                required: true,
                columns:[[  
                       {field:'Supplier_Name__c',title:'Supplier', width:300, sortable:true, sorter: function(a, b){
                         var va = (a === null) ? "" : "" + a,
                         vb = (b === null) ? "" : "" + b;
                         return va > vb ? 1 : ( va === vb ? 0 : -1 );
                       }} 
                ]],
                onLoadSuccess: function(param){ fixEscapedHTML($('#psrsupp').combogrid('getText'), 'psrsupp');
                },
                loader: function(param,success,error){
                var aSel = new Array();
                     $('#price_maintenance').find('input:checked').each(function(i, sel){ aSel.push($(sel).val());                      
                     });
                    Nexprice.getpsrsuppliers(aSel.join('-'), function(result, event){
                     if(event.type == 'exception') {
                        error.apply(this, arguments);         
                     } else {      
                       success(result);         
                     }
                 }, {buffer: true, escape: true, timeout:120000});
                },
                onSelect: function(param){ fixEscapedHTML($('#psrsupp').combogrid('getText'), 'psrsupp');}    
            });
            
   $('#psrsupp').combogrid('textbox').focusin(function(){ 
   $('#psrsupp').combogrid('clear');});
   $('#psrsupp').combogrid('setValue', $('#psrsupp').attr('data-compid'));
   fixEscapedHTML($('#psrsupp').attr('data-compname'), 'psrsupp');
   

}

function fnEvaluateTablePriceQuote(oTable){  
  var item = $('#mm21').menu('findItem', 'Release Quote');
  var item2 = $('#mm21').menu('findItem', 'Convert RFQ');
  var item3 = $('#mm21').menu('findItem', 'Modify Request');
  var item4 = $('#mm21').menu('findItem', 'Approve/Reject');
  $('#mm21').menu('disableItem', item.target);
  $('#mm21').menu('disableItem', item2.target);
  var countTrueRows = 0;
  var countFalseRows = 0; 
  var appRecord = 0;   
  var iSelected = 0;
  var quotecheck = 0;
  
  $(".SelectedAudit").each(function(i, v){
       if($(this).attr("checked") == "checked")
       { 
           var nTr = this.parentNode.parentNode;
           aData = oTable.fnGetData( nTr );
           iSelected ++;
           
           flagcheck = aData.Prospect_Material__c;
           if(flagcheck){
               countTrueRows++;
           }else{
               countFalseRows++;
           }

           if(aData.Type__c == 'Quote'){
               quotecheck++;
           }
           
           if(aData.Approval_Status__c == 'Approved'){
               appRecord++;
           } 
       }      
  });
  
  $('#mm21').menu('disableItem', item4.target);
  if(iSelected == 0)
  {    $('#mm21').menu('disableItem', item.target);
       $('#mm21').menu('disableItem', item2.target);
       $('#mm21').menu('disableItem', item3.target);
      
       
  }
  else
  {    
           if(aData.Prospect_Material__c == true){
                    
                   if(aData.Approval_Status__c == 'Approved'){
        
                       if((countTrueRows == iSelected ) || (countFalseRows == iSelected )){
                           if(!quotecheck){
                            
                           $('#mm21').menu('enableItem', item2.target);}
                        }
                       $('#mm21').menu('enableItem', item3.target);
                   }
                   if(aData.Approval_Status__c == 'Expired'){
                       $('#mm21').menu('enableItem', item3.target);
                   }
           }             
           else{
               if(aData.Approval_Status__c == 'Approved')
               {    $('#mm21').menu('enableItem', item3.target);
                    if((countTrueRows == iSelected ) || (countFalseRows == iSelected )){   
                        if(!quotecheck){
                            $('#mm21').menu('enableItem', item2.target);}
                        }
                        if(countFalseRows == iSelected && appRecord == iSelected){
                        $('#mm21').menu('enableItem', item.target);}
                }
               
               if( aData.Approval_Status__c == 'Expired')  {
                   $('#mm21').menu('enableItem', item3.target); 
                   if((countTrueRows == iSelected ) || (countFalseRows == iSelected )){   
                        if(!quotecheck){
                           $('#mm21').menu('enableItem', item2.target); }  
                   }  
               } 
           
        }
     }
}

function fnGetAudit(){
if($('#UserLookup2').val() != null)
Nexprice.getAuditnew($('#UserLookup2').val(), function(result, event){
                         if(event.type == 'exception') {

                                
                          } else { 
                             $('#audittable').dataTable().fnClearTable();
                             $('#audittable').dataTable().fnAddData(result);
                             fnUpdateFilterSelect('audittable', aColumnIndex_Draft);
                          }
           }, {buffer: true, escape: true, timeout:120000});
}
function refreshCount(){

Nexprice.getDataCount($('#mimipanel').serializeArray(), function(result, event){ 
              if(event.type == 'exception') {

                alert(event.message);        
                } else { 
                   if($('#price_maintenance').dataTable().fnGetData().length == result)
                   $('#countbannermessage').html('All ' + result + ' records matching the filter criteria have been added to the list. Click Clear Search to start a new search.');
                   else
                   $('#countbannermessage').html(result + ' records match your filters. Up to {!$Setup.nexPrice_Settings__c.Salesforce_Record_Limit__c} records may be added at once. To add more, click show more.');
                }
            }, {buffer: true, escape: true, timeout:120000});
}
function fnGetQuotes(){
if($('#UserLookup2').val() != null)
Nexprice.getQuotes($('#UserLookup2').val(), function(result, event){
                         if(event.type == 'exception') {

                           alert(event.message);      
                          } else { 
                             $('#quotetable').dataTable().fnClearTable();
                             $('#quotetable').dataTable().fnAddData(result);
                             fnUpdateFilterSelect('quotetable', aColumnIndex_Draft);
                          }
           }, {buffer: true, escape: true, timeout:120000});
}

function fnGetPending(index){
    if($('#UserLookup2').val() != null){
    Nexprice.fetchPendingWithSeller(index,$('#UserLookup2').val(), function(result, event){
                         if(event.type == 'exception') {

                           alert(event.message);      
                          } else { 
                             if(index == 2){
                            
                                 $('#pendingtable').dataTable().fnClearTable();
                                 $('#pendingtable').dataTable().fnAddData(result);
                                 fnUpdateFilterSelect('pendingtable', aColumnIndex_Draft);
                             }else{
                            
                                 $('#rejectalternate').dataTable().fnClearTable();
                                 $('#rejectalternate').dataTable().fnAddData(result);
                                 fnUpdateFilterSelect('rejectalternate', aColumnIndex_Draft);
                                 showCounter(result.length);
                             }
                          }
           }, {buffer: true, escape: true, timeout:120000});}
     else {
         showCounter(0); }
}

function fnInitTable(){
  $('#price_maintenance').dataTable({
                "aLengthMenu": [[100, 250, 500, 750], [100, 250, 500, 750]],
                "iDisplayLength": 100,
                "bDestroy": true,
                "fnDrawCallback": function( oSettings ) {
                   $('.row_selected').removeClass('row_selected');
                   $('.row_error').removeClass('row_error'); 
                },
                "bSort": true,
                "bJQueryUI": true,
                "sPaginationType": "four_button",
                "sAjaxDataProp": "accounts",
                "sErrMode": false,
                "sDom": 'flptir',
                "bAutoWidth": false,
                

                 "aoColumnDefs": [
                    { "aTargets":[ "Open"], sClass:"Open" ,sWidth:"2px", "bAutoWidth": false},
                    { "aTargets":[ "Select"], sClass:"Select", sWidth:"2px", "bAutoWidth": false },
                    { "aTargets":[ "Sold_To" ], "mData": "Account_Sold_To__c", sClass:"Account_Sold_To__c",sWidth:"2px", "bAutoWidth": false },
                    { "aTargets":[ "Ship_To" ], "mData": "Account_with_SalesOrg__c", sClass:"Account_with_SalesOrg__c",sWidth:"2px", "bAutoWidth": false },
                    { "aTargets":[ "Account_City" ], "mData": "Account_City__c", sClass:"Account_City__c",sWidth:"2px", "bAutoWidth": false },
                    { "aTargets":[ "Material" ], "mData": "SAP_Material__c", sClass:"Material__c",sWidth:"2px", "bAutoWidth": false,
                    "mRender": function ( data, type, full ) {
                        return '<a href="/'+ full.SAP_Material__c+'" target="_blank">' + full.Material__c+ '</a>'; }},
                    { "aTargets":[ "Price_Support_Ind" ], "mData": "Price_Support_Indicator__c", sClass:"Price_Support_Indicator__c",sWidth:"2px", "bAutoWidth": false },
                    
                    { "aTargets":[ "Base_Code" ], "mData": "Material_Base_Code__c", sClass:"Material_Base_Code__c",sWidth:"2px", "bAutoWidth": false },
                    { "aTargets":[ "Incoterms" ], "mData": "Freight_Terms__c", sClass:"Freight_Terms__c",sWidth:"2px", "bAutoWidth": false },
                    { "aTargets":[ "Customer_Material_Number" ], "mData": "Customer_Material_Number__c", sClass:"Customer_Material_Number__c",sWidth:"2px", "bAutoWidth": false },
                    { "aTargets":[ "Plant" ], "mData": "", sClass:"Plant_Name__c",sWidth:"2px", "bAutoWidth": false,
                    "mData": function ( source, type, val ) {
                            if((typeof source.Plant_Name__c == 'undefined') || source.Plant_Name__c == null)
                              return (source.Account_Sap_Plant__c);
                            else 
                              return (source.Plant_Name__c);
                            }
                    
                     },
                    { "aTargets":[ "Eff_Date" ], "mData": "", sClass:"CSP_Effective_Date__c",sWidth:"2px", "bAutoWidth": false,
                   
                      "mData": function ( source, type, val ) {
                          if (type === 'set') {
                              return;
                          }
                          else if (type === 'display') { 
                          if (source.CSP_Effective_Date__c != '' && source.CSP_Effective_Date__c != null){
                             var CSPDate = new Date(source.CSP_Effective_Date__c);
                             if('{!DateFormat}' == 'mm/dd/yy')
                                return (CSPDate.getUTCMonth()+1) + "/" + CSPDate.getUTCDate() + "/" + CSPDate.getUTCFullYear();
                              else{
                                return CSPDate.getUTCDate() + "/" + (CSPDate.getUTCMonth()+1) + "/" + CSPDate.getUTCFullYear();
                              }
                             }
                          else return '';}
                          else if (type === 'filter') {  return source.CSP_Effective_Date__c; }
                          else if (type === 'sort') { 
                           if((typeof source.CSP_Effective_Date__c == 'undefined') || source.CSP_Effective_Date__c == null)
                              return '';
                            else 
                             return new Date(source.CSP_Effective_Date__c);
                          }
                          return source.CSP_Effective_Date__c;
                      }
                    },
                    { "aTargets":[ "Exp_Date" ], "mData": "", sClass:"CSP_Expiration_Date__c",sWidth:"2px", "bAutoWidth": false,
                      "mData": function ( source, type, val ) {
                          if (type === 'set') {
                              return;
                          }
                          else if (type === 'display') { 
                          if (source.CSP_Expiration_Date__c != '' && source.CSP_Expiration_Date__c != null){
                             var CSPDate = new Date(source.CSP_Expiration_Date__c);
                             if('{!DateFormat}' == 'mm/dd/yy')
                                return (CSPDate.getUTCMonth()+1) + "/" + CSPDate.getUTCDate() + "/" + CSPDate.getUTCFullYear();
                              else
                                return CSPDate.getUTCDate() + "/" + (CSPDate.getUTCMonth()+1) + "/" + CSPDate.getUTCFullYear();
                             }
                             
                          else return '';}
                          else if (type === 'filter') {  return source.CSP_Expiration_Date__c; }
                          else if (type === 'sort') { 
                           if((typeof source.CSP_Expiration_Date__c == 'undefined') || source.CSP_Expiration_Date__c == null)
                              return '';
                            else 
                             return new Date(source.CSP_Expiration_Date__c);
                          }
                          return source.CSP_Expiration_Date__c;
                      }
                    },
                    { "aTargets":[ "Mat_Group3__c" ], "mData": "Material_Group_3__c", sClass:"Mat_Group3__c",sWidth:"2px", "bAutoWidth": false },
                    { "aTargets":[ "Avg_Order" ], sClass:"Avg_Order__c",sWidth:"2px", "bAutoWidth": false, 
                      "mData": function ( source, type, val ) {
                          if (type === 'set') {
                              return;
                          }
                          else if (type === 'display') { 
                              if((typeof source.Avg_Order__c == 'undefined')|| source.Avg_Order__c == null)
                                  return '';
                              else
                                  return source.Avg_Order__c;
                          }
                          else if (type === 'filter') {  return source.Avg_Order_Qty__c; }
                          else if (type === 'sort') { return source.Avg_Order_Qty__c; }
                          return source.Avg_Order_Qty__c;
                      }
                    },
                    
                    
                    { "aTargets":[ "CSP" ], sClass:"CSP__c",sWidth:"2px", "bAutoWidth": false,
                      "mData": function ( source, type, val ) {
                          if (type === 'set') {
                              return;
                          }
                          else if (type === 'display') { 
                          if((typeof source.CSP__c == 'undefined')|| source.CSP__c == null)
                                  return '';
                              else
                                  return source.CSP__c;
                         
                          }
                          else if (type === 'filter') {  
                             if(source.CSP_Price__c != '' && typeof source.CSP_Price__c != 'undefined' )
                             return source.CSP_Price__c + '.' ; 
                             else return '';
                             }
                          else if (type === 'sort') { return source.CSP_Price__c; }
                          return source.CSP__c;
                      }
                    
                    }, 
                    { "aTargets":[ "TPI" ], sClass:"TPI__c",sWidth:"2px", "bAutoWidth": false,
                      "mData": function ( source, type, val ) {
                          if (type === 'set') {
                              return;
                          }
                          else if (type === 'display') { 
                            if((typeof source.TPI__c == 'undefined') || source.TPI__c == null)
                              return '';
                            else 
                              return (source.TPI__c + '%');
                          }
                          else if (type === 'filter') {  return source.TPI__c; }
                          else if (type === 'sort') { return source.TPI__c; }
                          return source.TPI__c;
                      }
                    },
                    
                    { "aTargets":[ "Price_Protection" ], "mData": "Price_Protection__c", sClass:"Price_Protection__c",sWidth:"2px", "bAutoWidth": false },
                    { "aTargets":[ "SAPHistory" ], "mData": "Id", sClass:"SAPHistory",sWidth:"2px", "bAutoWidth": false,
                      "mRender": function ( data, type, full ) {
                        var ids = full.Id;
                        return '<input class="historyButton" type="button" onclick="popup(\''+ids+'\');" name="historyButton" value="SAP Price History" ></input>';
                        }                                  
                    },
                    { "aTargets":[ "ATPCheck" ], "mData": "Id", sClass:"ATPCheck",sWidth:"2px", "bAutoWidth": false,
                      "mRender": function ( data, type, full ) {
                        var ids = full.Id;
                        return '<input class="checkButton" type="button" onclick="atpCheck(\''+ids+'\');" name="checkButton" value="Check Inventory" ></input>';
                        }                                  
                    },
                    { "aTargets":[ "Id" ],"mData": "Id", sClass:"Id", bVisible: false,sWidth:"2px", "bAutoWidth": false},
                    { "aTargets":[ "Has_Open_PRT" ],"mData": "Has_Open_PRT__c", sClass:"Has_Open_PRT__c",sWidth:"2px", "bAutoWidth": false, "bVisible":false},
                    { "aTargets":[ "Has_Unit_Options" ],"mData": "Has_Unit_Options__c", sClass:"Has_Unit_Options__c",sWidth:"2px", "bAutoWidth": false, "bVisible":false},
                    { "aTargets":[ "UoMs" ], "mData":"UoMs__c", sClass:"UoMs__c", sWidth:"2px", "bAutoWidth":false, "bVisible":false},
                    { "aTargets":[ "UoM" ], "mData":"CSP_UoM__c", saClass:"CSP_UoM__c", sWidth:"2px", "bAutoWidth":false, "bVisible":false},
                    { "aTargets":[ "Prospect_Material" ], "mData": "Prospect_Material__c", sClass:"Prospect_Material__c",sWidth:"2px", "bAutoWidth": false, "bVisible":false },
                    { "aTargets":[ "InnTable" ], "mData": "Inner_Table__c", sClass:"Inner_Table__c",sWidth:"2px", "bAutoWidth": false, "bVisible":false }
                    ],
                  "fnInitComplete": function(oSettings) { 
                     aColumnIndex = fnGetColumnIndex(oSettings);
                     
                     $('.showhide').each(function(i, bc){
                        var oTable = $('#price_maintenance').dataTable();
                        if( oTable.fnSettings().aoColumns[aColumnIndex[$(this).attr('name')]].bVisible==true)
                            $(this).attr('checked', true);
    
                     });
                  },
                  "fnCreatedRow": function( nRow, aData, iDataIndex ) {
                    
                    $('td:eq(' + aColumnIndex['Open'] + ')', nRow).html( '<img class="details_img" src="{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/images/details_open.png')}">' );
                    fnSetImgListener(nRow, 'price_maintenance');                   
                    
                    if((aData.Has_Open_PRT__c == true && aData.Prospect_Material__c == true))
                        $('td:eq(' + aColumnIndex['Select'] + ')', nRow).html( '<input class="select_row" type="checkbox", value="' + aData.Id + '" disabled="disabled">' );
                    else if((aData.Has_Open_PRT__c == true || aData.Has_Unit_Options__c == false) && aData.Prospect_Material__c == false)
                        $('td:eq(' + aColumnIndex['Select'] + ')', nRow).html( '<input class="select_row" type="checkbox", value="' + aData.Id + '" disabled="disabled">' );
                    else
                        $('td:eq(' + aColumnIndex['Select'] + ')', nRow).html( '<input class="select_row" type="checkbox", value="' + aData.Id + '">' );
                    
                    
                    fnSetCheckboxListener(nRow, $('#price_maintenance').dataTable())
                    aRecordIds[aData.Id] = iDataIndex;
                 }
          }); 
          
                
}

function popup(Id){

window.open('/apex/SAP_Price_History?ids='+ Id);
}

function atpCheck(Id){
var source = 'neXprice';
window.open('/apex/AtpInventorySearchNexprice?id='+ Id+'&source='+source);
}

function fnSetCheckboxListener(nRow, oTable){
  $(nRow).find('input:checkbox').click(function(){
  <!--code added to enable disable Set Price for Multiple Dates from menu-->
        var iSelected = 0;
        $(".select_row").each(function(i, v){
            if($(this).attr("checked") == "checked"){
            iSelected ++;
            if(iSelected > 0){
                var itemNext = $('#mm1').menu('findItem', 'Set Price for Multiple Dates');
                
            } 
        
            
       }});
      <!--code end-->
     
      var tab = $('#main').tabs('getSelected');
      var index = $('#main').tabs('getTabIndex',tab);
      fnEvaluateTable(oTable);
      if(index == 3)     
          fnEvaluateTableRejectAlternate(oTable);
      if(index == 1)
          fnEvaluateTablePriceQuote(oTable);
  });
}
function fnEvaluateTable(oTable){
  
  var sText = null;
  var sText1 = null;
  var sText2 = null;
  var sText3;
  var bSame = true;
  var bSame2 = true;
  var counttruerows = 0;
  
  var item = $('#mm1').menu('findItem', 'Create RFQ');
  var item2 = $('#mm1').menu('findItem', 'Adjust Price');
  var item3 = $('#mm1').menu('findItem', 'Create Quote');
  var item4 = $('#mm1').menu('findItem', 'Set Price');
  var item5 = $('#mm1').menu('findItem', 'Expire CSP');
  var item6 = $('#mm1').menu('findItem', 'Set Price for Multiple Dates');
  var item7 = $('#mm1').menu('findItem', 'Remove CPI');
  var item8 = $('#mm1').menu('findItem', 'Create/Modify PSR');
 
           
  var iSelected = 0;
         $(".select_row").each(function(i, v){
         $('#mm1').menu('disableItem', item5.target);
           if($(this).attr("checked") == "checked")
           { iSelected ++;
             var nTr = this.parentNode.parentNode;
             aData = oTable.fnGetData( nTr );
             
                           
             if(sText == null)
                sText = aData.UoMs__c;
             else
               if(sText != aData.UoMs__c)
                 bSame = false;

             if(sText2 == null)
               sText2 = aData.CSP_UoM__c;
               
             sText3 = aData.Prospect_Material__c;
             
             if((sText2 != null && sText2 != aData.CSP_UoM__c) || aData.CSP_UoM__c == '' || aData.CSP_UoM__c == undefined || aData.CSP_UoM__c == null)
                 bSame2 = false;      
                 
             if(sText1 == null)
                sText1 = aData.Material_Base_Code__c;
             else
               if(sText1 != aData.Material_Base_Code__c)
                 bSame = false;
              
             var cspval = aData.Inner_Table__c;
              
              if(cspval.indexOf('csphasval') >= 0){
                  counttruerows++;
                 
              } 
            }      
         });
        
                
         if(iSelected == 0) 
         {    
              $('#mm1').menu('disableItem', item.target);
              $('#mm1').menu('disableItem', item2.target);
              $('#mm1').menu('disableItem', item3.target);
              $('#mm1').menu('disableItem', item4.target);
              $('#mm1').menu('disableItem', item5.target);
              $('#mm1').menu('disableItem', item6.target);
              $('#mm1').menu('disableItem', item8.target);
         }
         else
         {   
             if(aData.Prospect_Material__c == false){
                 $('#mm1').menu('enableItem', item3.target);
                 $('#mm1').menu('enableItem', item4.target);
                 $('#mm1').menu('enableItem', item6.target);
                 if(iSelected == 1)
                     $('#mm1').menu('enableItem', item8.target);
                 else 
                     $('#mm1').menu('disableItem', item8.target);
                 if(iSelected == counttruerows)
                 $('#mm1').menu('enableItem', item5.target);
                 
             }
             if(bSame == true) {
                $('#mm1').menu('enableItem', item.target);
                
                }
             else {
                $('#mm1').menu('disableItem', item.target);
                
              }  
             
             if(iSelected > 1 && sText3 == true){
                  $('#mm1').menu('disableItem', item.target);
                  $('#mm1').menu('disableItem', item3.target);
                  $('#mm1').menu('disableItem', item4.target);
                  $('#mm1').menu('disableItem', item6.target);
                  $('#mm1').menu('disableItem', item5.target); 
                  $('#mm1').menu('disableItem', item8.target);
                         
             }              
             if(bSame2 == true) 
                $('#mm1').menu('enableItem', item2.target);
             else
                $('#mm1').menu('disableItem', item2.target);
             
         }
}

function fnEvaluateTableRejectAlternate(oTable){
  
  var item10 = $('#mm21').menu('findItem', 'Approve/Reject');
 
  var iSelected = 0;
  $(".SelectedAudit").each(function(i, v){
       if($(this).attr("checked") == "checked")
       { iSelected ++;
       }      
  });
  var item = $('#mm21').menu('findItem', 'Release Quote');
  var item2 = $('#mm21').menu('findItem', 'Convert RFQ');
  var item3 = $('#mm21').menu('findItem', 'Modify Request');
  $('#mm21').menu('disableItem', item.target);
  $('#mm21').menu('disableItem', item2.target);
  $('#mm21').menu('disableItem', item3.target);
  
  if(iSelected == 0) 
  
    {       
       
        $('#mm21').menu('disableItem', item10.target);
    }
  else
    {       
        $('#mm21').menu('enableItem', item10.target);
    }
}


function fnSetImgListener(nRow, type){
$('.details_img', nRow).click(function(){
       
        if ( this.src.match('details_close') )
        {
           this.src = "{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/images/details_open.png')}";
           $('#' + type).dataTable().fnClose( nRow );
        }else{
           this.src = "{!URLFOR($Resource.JQuery_Pricing, '/JQuery_Pricing/images/details_close.png')}";
           $('#' + type).dataTable().fnOpen( nRow, fnFormatDetails(nRow, type ), 'details' ); 
           $('.innerTable').dataTable({
                 "bDestroy": true,
                 "bPaginate": false,
                 "bLengthChange": false,
                 "bFilter": false,
                 "bSort": false,
                 "bInfo": false
            });
            
         }
  });
}

function fnGetColumnIndex(oSettings){
    var aColumns = new Array();
    $.each(oSettings.aoColumns, function(c){
        var mData = oSettings.aoColumns[c].sClass;
            aColumns[mData] = c;
    });

    return aColumns;
}
function fnClearTable(){
  $('#price_maintenance').dataTable().fnClearTable();
  aRecordIds = new Array();
}
function fnReleaseQuote(){
  var arr = new Array();
  $('#quotetable').find('input:checked').not('input[disabled="disabled"]').each(function(i, nRow){ arr.push($(nRow).val()); });

  Nexprice.ReleaseQuote(arr, function(result, event){
                         if(event.type == 'exception') {

                           alert(event.message);      
                          } else { 
                           fnGetQuotes();
                          } 
  }, {buffer: true, escape: true, timeout:120000});
}

function fnAddData(data, oTable){

var aaIds = new Array();
var iSets = {!$Setup.nexPrice_Settings__c.Salesforce_Record_Limit__c} / {!$Setup.nexPrice_Settings__c.SAP_Record_Limit__c};
var iHigh = {!$Setup.nexPrice_Settings__c.Salesforce_Record_Limit__c} / iSets;

var x = 0;
var y = 0;
aaIds[0] = new Array();
$(data).each(function(i, e){
   if(y<iHigh)
   {  aaIds[x][y] = e.Id; 
      y = y + 1;
   }  
   else
   {  x = x + 1;
      y = 0;
      aaIds[x] = new Array();
      aaIds[x][y] = e.Id;
      y = y + 1;
   }
});

var a = new Array();
iProcessing = 0;

for(var i=0; i<aaIds.length; i++)
{   
    if(aaIds[i].length > 0)
    Nexprice.getPricing( a, aaIds[i], function(result, event){   
            if(event.type == 'exception') {
            
            alert('getPricing: ' + event.message);
            fnHideFog();
            } else {                  
                  oTable.fnAddData(result);  
                  fnUpdateFilterSelect('price_maintenance', aColumnIndex);
                  fnHideFog();
            }
    }, {buffer: false, escape: true, timeout:120000});
}
}
function fnUpdateFilterSelect(stableid, aColIndex){
$('#' + stableid).find('.selectinput').each(function(i, sel){

  var val = $(sel).val();
  $(sel).empty();
  
  var opt = '<option value=""';
  if(val == $(sel).attr('name'))
  opt += ' selected="selected" ';
  opt += '>' + $(sel).attr('name') + '</option>';
  var arr = $('#' + stableid).dataTable().fnGetColumnData(aColIndex[$(sel).attr('data-field')]);
  $(arr).each(function(j, o){
    opt = opt + '<option value="' + o + '"';
    if(val == o)
    opt += ' selected="selected" ';
    opt += '>' + o + '</option>';
  });
  $(sel).append(opt);
 
});
  
}
function fnPrepFilters(stableid, aColIndex){
$('#' + stableid).find('.textfilter').each(function(i, f){ $(f).html('<div style="width:105px;"><input data-field="'+ $(f).attr('data-field') +'" class="textinput" placeholder="' + $(f).html() + '" name="' + $(f).html() + '" style="width:100px;"/></div>') });
$('#' + stableid).find('.numberfilter').each(function(i, f){ $(f).html('<div class="numberinput" data-field="'+ $(f).attr('data-field') +'" style="width:105px;"><input data-field="'+ $(f).attr('data-field') +'" class="numberinputfrom" placeholder="From ' + $(f).html() + '" name="From ' + $(f).html() + '" style="width:50px;"/><b>&nbsp;To&nbsp;</b><input class="numberinputto" placeholder="To ' + $(f).html() + '" name="To ' + $(f).html() + '" style="width:50px;"/></div>') });
$('#' + stableid).find('.datefilter').each(function(i, f){ $(f).html('<div class="dateinput" style="width:155px;" data-field="'+ $(f).attr('data-field') +'"><input class="dateinputfrom" name="From ' + $(f).html() + '" placeholder="From ' + $(f).html() + '" style="width:75px;"/><b>&nbsp;To&nbsp;</b><input class="dateinputto" placeholder="To ' + $(f).html() + '" name="To ' + $(f).html() + '" style="width:75px;"/></div>') });
$('#' + stableid).find('.listfilter').each(function(i, f){ $(f).html('<div style="width:105px;"><select data-field="'+ $(f).attr('data-field') +'" class="selectinput" name="' + $(f).html() + '" style="width:100px;"><option selected="selected" value="' + $(f).html() + '">' + $(f).html() + '</option></select></div>') });
$( ".dateinputfrom, .dateinputto" ).datepicker({ changeMonth:true, changeYear:true, dateFormat: "{!dateFormat}"});
fnUpdateFilterSelect(stableid, aColIndex);
$('.selectinput').change(function(){
   $('#' + stableid).dataTable().fnFilter($(this).val(), aColIndex[$(this).attr('data-field')] );
   fnUpdateFilterSelect(stableid, aColIndex);
  });
$(".textinput").keyup( function () { $('#' + stableid).dataTable().fnFilter( this.value, aColIndex[$(this).attr('data-field')] ); fnUpdateFilterSelect(stableid, aColIndex); });

$('.numberinputfrom, .numberinputto').keyup(function(){ $('#' + stableid).dataTable().fnDraw(); fnUpdateFilterSelect(stableid, aColIndex);});
$('.dateinputfrom, .dateinputto').change(function(){ $('#' + stableid).dataTable().fnDraw(); fnUpdateFilterSelect(stableid, aColIndex); });
$(".numberinput").each(function(i, ni){
  $('#' + stableid).dataTable().dataTableExt.afnFiltering.push(
    function (oSettings, aData, iDataIndex) {
                    if ($('#' + stableid).dataTable().attr("id") != oSettings.sTableId){ return true; }
                    var iMin = $(ni).find('.numberinputfrom').val();
                    var iMax = $(ni).find('.numberinputto').val();
                    var iValue = (isNaN(aData[aColIndex[$(ni).attr('data-field')]]) || aData[aColIndex[$(ni).attr('data-field')]] == null || aData[aColIndex[$(ni).attr('data-field')]] == "")? -1 : aData[aColIndex[$(ni).attr('data-field')]];
                    if ((iMin == "" || isNaN(iMin)) && (iMax == "" || isNaN(iMax))) { return true;} 
                    else if ((iMin == "" || isNaN(iMin)) && iValue <= iMax) { return true; }
                    else if (iMin <= iValue && (iMax == "" || isNaN(iMax))) { return true; }
                    else if (iMin <= iValue && iValue <= iMax) { return true; }
                    return false;
   });
});
$(".dateinput").each(function(i, di){
  $('#' + stableid).dataTable().dataTableExt.afnFiltering.push(
    function (oSettings, aData, iDataIndex) {
                    if ($('#' + stableid).dataTable().attr("id") != oSettings.sTableId){ return true; }
                    var iMin =  $(di).find('.dateinputfrom').val();
                    if(iMin !=  $(di).find('.dateinputfrom').attr('name'))
                      iMin = $(di).find('.dateinputfrom').datepicker( "getDate" );
                      if(iMin != null)
                        iMin = Date.UTC(iMin.getUTCFullYear(), iMin.getUTCMonth(),iMin.getUTCDate());
                    var iMax =  $(di).find('.dateinputto').val();
                    if(iMax !=  $(di).find('.dateinputto').attr('name'))  
                      iMax = $(di).find('.dateinputto').datepicker( "getDate" );
                      if(iMax != null)
                        iMax = Date.UTC(iMax.getUTCFullYear(), iMax.getUTCMonth(),iMax.getUTCDate());
                    var iValue = new Date( aData[aColIndex[$(di).attr('data-field')]]);
                    if ((iMin == "" || iMin == null || iMin == $(di).find('.dateinputfrom').attr('name')) && (iMax == "" || iMax == null || iMax == $(di).find('.dateinputto').attr('name')) ) { return true;} 
                    else if ((iMin == "" || iMin == null || iMin == $(di).find('.dateinputfrom').attr('name'))  && iValue <= iMax) { return true; }
                    else if (iMin <= iValue && (iMax == "" || iMax == null || iMax == $(di).find('.dateinputto').attr('name'))) { return true; }
                    else if (iMin <= iValue && iValue <= iMax) { return true; }
                    return false;
   });
});
/*to auto select logged in user checkbox for Price quotes and audits, code added by anuja*/
$("#UserLookup2").multiselect("widget").find(":checkbox").each(function(){
                 if( $(this).val() === '{!myEmpId}')
                    if($(this).prop('checked') == false)
                        this.click();
                    
               });


/*code ends*/
}

</script>
<style>
label.error {
    color: red;
}
div.error{
border-style:solid;
border-width:1.5px;
border-color:red;
}
input.error{
border-style:solid;
border-color:red;
}
select.error{
border-style:solid;
border-color:red;
}
</style>
<input type="hidden" id="apprids" />
<div id="loadingbanner" style="position:relative;left:px">
<c:EnhancedActionStatus BackColor="#efefef" borderColor="#336699" borderSize="3" height="20px" width="100px" ImageUrl="{!$Resource.spinner}" Message="Loading..." messageStyle="color:darkred;font-size:11pt;font-weight:bold;"/>

</div>
<table><tr><td>
<div id="nextoolbar" >
        <a href="javascript:void(0)" id="sb1" class="easyui-menubutton" data-options="menu:'#mm1',iconCls:'icon-edit'" >Menu</a>
        <a href="javascript:void(0)" id="sb2" class="easyui-menubutton" data-options="menu:'#mm2',iconCls:'icon-search'" >Show / Hide</a>

</div>
<div id="nextoolbar2" >
        <a href="javascript:void(0)" id="sb1" class="easyui-menubutton" data-options="menu:'#mm21',iconCls:'icon-edit'" >Menu</a>
        <select class="mselect" style="width:225px;" data-label="Account_Owner_Name__c" name="Team_Employee_Ids__c" data-acctfieldname="Team_Employee_Ids__c" data-name="Account Owners" multiple="multiple" id="UserLookup2"><apex:outputtext value="{!OwnerOptions}" escape="false"/></select>    
</div>
</td><td>

</td></tr></table>
<br/>
<div  id="main" style="width:3200px;"> 
<div id="maintab" title="Price Maintenance" style="padding:10px;width:2700px;">
    <div id="mm1" style="width:180px;">
        <div id="SelectAll" >Select All</div>
        <div id="Reset" >Deselect All</div>
        <div id="ClearFilters">Clear Filters</div>
        <div class="menu-sep" id="sep1"></div>
        <div id="createcsp">Set Price</div>
        <div id="adjust">Adjust Price</div>
        <div id="createquote">Create Quote</div>
        <div id="setprice">Create RFQ</div>   
        <div id="expirecsp">Expire CSP</div>
        <div id="deletecsp">Remove CPI</div>
             
        <div id="addmaterial">Add Material</div>
        <div id="priceChange">Set Price for Multiple Dates</div>
        <div id="createpsr">Create/Modify PSR</div>
        <div class="menu-sep" id="sep2"></div>
        <div id="mimi" data-options="iconCls:'icon-search'">Multi-Search</div>
    </div>
    <div id="mm2" style="width:150px;">
            
        
        <div ><input class = "showhide" type="checkbox" name="Account_Sold_To__c" />&nbsp;&nbsp;Sold To</div>
        <div><input class = "showhide" type="checkbox" name="Account_City__c" />&nbsp;&nbsp;City</div>
        <div ><input class = "showhide" type="checkbox" name="Material__c" />&nbsp;&nbsp;Material</div>
        <div><input class = "showhide" type="checkbox" name="CSP__c" />&nbsp;&nbsp;CSP</div>
        <div ><input class = "showhide" type="checkbox" name="CSP_Effective_Date__c" />&nbsp;&nbsp;Start Date</div>
        <div ><input class = "showhide" type="checkbox" name="Customer_Material_Number__c" />&nbsp;&nbsp;Customer Material</div>
        <div><input class = "showhide" type="checkbox" name="Plant_Name__c" />&nbsp;&nbsp;Plant</div>
        <div ><input class = "showhide" type="checkbox" name="Mat_Group3__c" />&nbsp;&nbsp;Material Type</div>
        <div ><input class = "showhide" type="checkbox" name="Avg_Order__c" />&nbsp;&nbsp;Average Order Qty</div>
        <div ><input class = "showhide" type="checkbox" name="TPI__c" />&nbsp;&nbsp;TPI%</div>
        <div ><input class = "showhide" type="checkbox" name="Material_Base_Code__c" />&nbsp;&nbsp;Material Base</div>
        <!--<div><input class = "showhide" type="checkbox" name="Target__c" />&nbsp;&nbsp;Target</div>
        <div><input class = "showhide" type="checkbox" name="Drum_Deposit__c" />&nbsp;&nbsp;Drum Deposit</div>-->
        <div ><input class = "showhide" type="checkbox" name="Price_Support_Indicator__c" />&nbsp;&nbsp;Price Support</div> 
        <div><input class = "showhide" type="checkbox" name="Price_Protection__c" />&nbsp;&nbsp;Price Protection</div>
        
    </div>

<form id="mimipanel" action="/apex/Account_Material_Ajax" method="post">
<table>

<tr>
<td><select id="sldto" class="mselect" style="width:225px;" data-label="Account_Sold_To__c" data-acctfieldname="SAP_Sold_To_Account_Id__c" name="Account_Sold_To_Id_Ext__c" data-name="Sold To" multiple="multiple"></select></td>
<td><select id="shto" class="mselect" style="width:225px;" data-label="Account_Name__c"  name="Account__c" data-acctfieldname="Id" data-name="Ship To" multiple="multiple"></select></td>
<td><select id="mat" class="mselect" style="width:225px;" data-label="Material_Name__c" name="SAP_Material__c" data-matfieldname="Name" data-name="Material" multiple="multiple"></select></td>
<td><select id="bcode" class="mselect" style="width:225px;" data-label="Material_Base_Code__c" name="Material_Base__c"  data-matfieldname="Material_Base_Code__c" data-name="Base Code" multiple="multiple"></select></td>

</tr>
<tr class="advanced">
<td><select class="mselect" style="width:225px;" data-label="Account_Owner_Name__c" name="Team_Employee_Ids__c" data-acctfieldname="Team_Employee_Ids__c" data-name="Owners" multiple="multiple" id="shtoowners"><apex:outputtext value="{!OwnerOptions}" escape="false"/></select></td>
<td><select class="mselect" style="width:225px;" data-label="Account_SAP_Sales_Group__c" name="Account_SAP_Sales_Group__c" data-acctfieldname="SAP_SalesGroup__c" data-name="Sales Groups" multiple="multiple"><apex:outputtext value="{!GroupOptions}" escape="false"/></select></td>
<td><select class="mselect" style="width:225px;" data-label="Account_Sold_To_Seller__c"  name="Account_Sold_To_Owner_Id__c" data-acctfieldname="SAP_Sold_To_Account_Owner__c" data-name="Sold To Sellers" multiple="multiple"><apex:outputtext value="{!UserOptions}" escape="false"/></select></td>
<td><select class="mselect" style="width:225px;" data-label="Account_HQ_Sales_Office__c" name="Account_HQ_Sales_Office__c" data-acctfieldname="HQ_Sales_Office__c" data-name="HQ Sales Office" multiple="multiple"><apex:outputtext value="{!OfficeOptions}" escape="false"/></select></td>
</tr>
<tr class="advanced">
<td><select class="mselect" style="width:225px;" data-label="Account_Sales_Org__c" name="Account_Sales_Org_Code__c" data-acctfieldname="SAP_Sales_Org__c" data-name="Sales Orgs" multiple="multiple"><apex:outputtext value="{!OrgOptions}" escape="false"/></select></td>
<td><select class="mselect" style="width:225px;" data-label="Account_Division__c" name="Account_Division_Code__c" data-acctfieldname="SAP_DivisionCode__c" data-name="Divisions" multiple="multiple"><apex:outputtext value="{!DivOptions}" escape="false"/></select></td>
<td><select id="corp" class="mselect" style="width:225px;" data-label="Account_Corp_Account_Id_Ext__c" data-acctfieldname="SAP_Corporate_Account_Id__c" name="Account_Corp_Account_Id_Ext__c" data-name="Corporate" multiple="multiple"></select></td>
<td><select class="mselect" style="width:225px;" data-label="Account_Industry__c" name="Account_Industry_Code__c" data-acctfieldname="Industry_Key__c" data-name="Account Industries" multiple="multiple"><apex:outputtext value="{!IndOptions}" escape="false"/></select></td>
</tr>
<tr class="advanced">
<td><select class="mselect" style="width:225px;" data-label="Material_Supplier__c" name="PH4__c" data-name="Suppliers" data-matfieldname="PH4_Supplier_Code__c" multiple="multiple"><apex:outputtext value="{!PH4s}" escape="false"/></select></td>
<td><select class="mselect" style="width:225px;" data-label="Material_Family__c" name="PH5__c" data-name="Families" data-matfieldname="PH5_Family_Code__c" multiple="multiple"><apex:outputtext value="{!PH5s}" escape="false"/></select></td>
<td><select class="mselect" style="width:225px;" data-label="Material_Segment__c" name="PH6__c" data-name="Segments" data-matfieldname="PH6_Segment_Code__c" multiple="multiple"><apex:outputtext value="{!PH6s}" escape="false"/></select></td>
<td><select class="mselect" style="width:225px;" data-label="Material_SubSegment__c" name="PH7__c" data-matfieldname="PH7_SubSegment_Code__c" data-name="Subsegments" multiple="multiple"><apex:outputtext value="{!PH7s}" escape="false"/></select></td>
</tr>
<tr class="advanced">
<td><select class="mselect" style="width:225px;" data-label="Material_Product_Class__c" name="Material_Group_1__c" data-matfieldname="Material_Group1_Code__c" data-name="Material Classes" multiple="multiple"><apex:outputtext value="{!MatGroups}" escape="false"/></select></td>
<td><select class="mselect" style="width:225px;" data-label="Material_Container_Code__c" name="Material_Container_Code__c" data-matfieldname="Material_Container_Iso_Code__c" data-name="Container Code" multiple="multiple"><apex:outputtext value="{!Containers}" escape="false"/></select></td>
<td><select class="mselect" style="width:225px;" data-label="Material_Division__c" name="Material_Division__c" data-matfieldname="Division_Code__c" data-name="Material Divisions" multiple="multiple">
<option value="31">31 - Nexeo Chem</option>
<option value="32">32 - Nexeo Plas</option>
<option value="33">33 - Nexeo Comp</option>
<option value="34">34 - Nexeo Env Svcs</option>
</select></td>
<td><select class="mselect" style="width:225px;" data-label="Material_Group3_Desc__c" name="Material_Group_3__c"  data-matfieldname="Material_Group3_Desc__c" data-name="Material Type" multiple="multiple" id="materialtype"><apex:outputtext value="{!MaterialTypeOptions}" escape="false"/></select></td>
<td/>
</tr>
</table>
<br/>
<table>
<tr>
<td/>
<td><button type="submit" id="submitsearch" data-status="enable" value="Search">Search</button></td>
<td><button type="reset" id="clearsearch" value="Reset">Clear Search</button></td>
<td><button type="button" id="pageselect" data-status="disable" disabled="disabled" data-pages="0" data-page="0" >Show More (0)</button></td>

</tr>
</table>
</form>

<div id="countbanner">
<span>
<div class="message infoM2">
<table class="messageTable" cellspacing="0" cellpadding="0" border="0" style="padding:0px;margin:0px;">
<tbody><tr valign="top"><td><img class="msgIcon" title="info" src="/s.gif" alt="info"></img>
</td><td class="messageCell"><div class="messageText"><span ><h4></h4></span><span id="countbannermessage">0 records match your filters. Up to {!$Setup.nexPrice_Settings__c.Salesforce_Record_Limit__c} records may be added at once. To add more, click search again.</span>
<br></br></div></td></tr><tr><td></td><td></td></tr></tbody></table>
</div></span>
</div><br/>
<table id="price_maintenance" class="display" width="100%">
<thead>
<tr>
<th class="Open" rowspan="2">Open</th>
<th class="Select" rowspan="2">Select</th>
<th class="textfilter" data-field="Account_Sold_To__c">Sold To</th>
<th class="textfilter" data-field="Account_with_SalesOrg__c">Ship To</th>
<th class="textfilter" data-field="Account_City__c">City</th>
<th class="textfilter" data-field="Material__c">Material</th>
<th class="textfilter" data-field="CSP__c">CSP</th>
<th class="textfilter" data-field="Freight_Terms__c">Incoterms</th>
<th class="datefilter" data-field="CSP_Effective_Date__c">Start Date</th>
<th class="datefilter" data-field="CSP_Expiration_Date__c">End Date</th>
<th class="textfilter" data-field="Customer_Material_Number__c">Customer Material</th>
<th class="textfilter" data-field="Plant_Name__c">Plant</th>
<th class="textfilter" data-field="Mat_Group3__c">Material Type</th>
<th class="numberfilter" data-field="Avg_Order__c">Avg Order</th>
<th class="numberfilter" data-field="TPI__c">TPI %</th>
<th class="textfilter" data-field="Material_Base_Code__c">Base Code</th>
<th class="listfilter" data-field="Price_Support_Indicator__c">Price Support</th> 
<!--<th class="numberfilter" data-field="Target__c">Target</th>
<th class="listfilter" data-field="Drum_Deposit__c">Drum Dep</th>-->
<th class="listfilter" data-field="Price_Protection__c">Price Protection</th>
<th >SAP Price History</th>
<th >Check Inventory</th>
<th >Id</th>
<th >Has Open PRT</th>
<th >Has Unit Options</th>
<th >UoMs</th>
<th >UoM</th>
</tr>
<tr>

<th class="Sold_To">Sold To</th>
<th class="Ship_To">Ship To</th>
<th class="Account_City">City</th>
<th class="Material">Material</th>
<th class="CSP">CSP</th>
<th class="Incoterms">Incoterms</th>
<th class="Eff_Date">Start Date</th>
<th class="Exp_Date">End Date</th>
<th class="Customer_Material_Number">Customer Material</th>
<th class="Plant">Plant</th>
<th class="Mat_Group3__c">Material Type</th>
<th class="Avg_Order">AOQ</th>
<th class="TPI">TPI %</th>
<th class="Base_Code">Base Code</th>
<th class="Price_Support_Ind">Price Support</th> 
<!--
<th class="Target">Target</th>
<th class="Drum_Dep">Drum Dep</th>-->
<th class="Price_Protection">Price Protection</th>
<th class="SAPHistory">SAP Price History</th>
<th class="ATPCheck">Check Inventory</th>
<th class="Id">Id</th>
<th class="Has_Open_PRT">Has Open PRT</th>
<th class="Has_Unit_Options">Has Unit Options</th>
<th class="UoMs">UoMs</th>
<th class="UoM">UoM</th>
<th class="Prospect_Material">Prospect Material</th>
</tr>
</thead>
<tbody></tbody>
</table>
<br/><br/><br/>
<div id="loadtarget"></div>
</div><!--End Price Maintenance Tab-->
<div id="quotetab" title="Price Quotes" style="padding:10px;"> 

    <div id="mm21" style="width:150px;">
        <div id="approverejectChange">Approve/Reject</div>
        <div id="SelectAll2">Select All</div>
        <div id="Reset2">Deselect All</div>
        <div id="ClearFilters2">Clear Filters</div>
        <div class="menu-sep"></div>
        <div id="convertrfq">Convert RFQ</div>
        <div id="modifyrfq">Modify Request</div>
        <div id="ReleaseQuote" onclick="fnReleaseQuote()">Release Quote</div>
    </div>
<div style="width:1500px;">
            <table id="quotetable" class="display viewtable">
                <thead>
                    <tr>
                        <th class="Open" rowspan="2">Open</th>
                        <th class="Select" rowspan="2">Select</th>
                        <th class="listfilter" data-field="Approval_Status__c">Status</th>
                        <th class="listfilter" data-field="Approval_Level__c">Approval Level</th>
                        <th class="textfilter" data-field="Approver__r.Name">Approver</th>
                        <th class="listfilter" data-field="Type__c">Type</th>
                        <th class="textfilter" data-field="SAP_SoldTo_Account__c">Sold To</th>
                        <th class="textfilter" data-field="SAP_ShipTo_Account__c">Ship To</th>
                        <th class="textfilter" data-field="Material__c">Material</th>
                        <th class="datefilter" data-field="Requested_Effective_Date__c">Eff Date (Y-M-D)</th>
                        <th class="datefilter" data-field="Requested_Expiration_Date__c">Exp Date (Y-M-D)</th>
                        <th class="numberfilter" data-field="Volume__c">Volume</th>
                        <th class="listfilter" data-field="Requested_UoM__c">UoM</th>
                        <th class="numberfilter" data-field="Price__c">Price</th>
                        <th class="listfilter" data-field="Requested_Price_UoM__c">UoM</th>
                        <th class="numberfilter" data-field="TPI__c">TPI</th>
                        <th class="textfilter" data-field="Comments__c">Comments</th>
                        <th class="textfilter" data-field="Approval_Rejection_Comments__c">Approval Comments</th>
                        <th class="textfilter" data-field="Name">Transaction</th>
                        <th >Id</th>
                        <th >Inner Table</th>
                    </tr>
                    <tr>
                          <th class="Approval_Status">Status</th>
                          <th class="Approval_Level">Approval Level</th>
                          <th class="Approver">Approver</th>
                          <th class="Type">Type</th>
                          <th class="Sold_To">Sold To</th>
                          <th class="Ship_To">Ship To</th>
                          <th class="Material">Material</th>
                          <th class="Eff_Date">Start Date</th>
                          <th class="Exp_Date">Expiration Date</th>
                          <th class="Volume">Volume</th>
                          <th class="Requested_UoM">UoM</th>
                          <th class="Price">Price</th>
                          <th class="Requested_Price_UoM">UoM</th>
                          <th class="TPI">TPI</th>
                          <th class="Comments">Comments</th>
                          <th class="Approval_Rejection_Comments">Approval Comments</th>
                          <th class="Transaction">Transaction</th>
                          <th class="Id">Id</th>
                          <th class="Inner_Table">Inner Table</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
      </div>
      <div id="loadtarget2"></div>
</div>
<div id="pendingtab" title="Pending" style="padding:10px;"> 

<div style="width:1500px;">
            <table id="pendingtable" class="display viewtable">
                <thead>
                    <tr>
                        <th class="Open" rowspan="2">Open</th>
                        <th class="Select" rowspan="2">Select</th>
                        <th class="listfilter" data-field="Approval_Status__c">Status</th>
                        <th class="listfilter" data-field="Approval_Level__c">Approval Level</th>
                        <th class="textfilter" data-field="Approver__r.Name">Approver</th>
                        <th class="listfilter" data-field="Type__c">Type</th>
                        <th class="textfilter" data-field="SAP_SoldTo_Account__c">Sold To</th>
                        <th class="textfilter" data-field="SAP_ShipTo_Account__c">Ship To</th>
                        <th class="textfilter" data-field="Material__c">Material</th>
                        <th class="datefilter" data-field="Requested_Effective_Date__c">Eff Date (Y-M-D)</th>
                        <th class="datefilter" data-field="Requested_Expiration_Date__c">Exp Date (Y-M-D)</th>
                        <th class="numberfilter" data-field="Volume__c">Volume</th>
                        <th class="listfilter" data-field="Requested_UoM__c">UoM</th>
                        <th class="numberfilter" data-field="Price__c">Price</th>
                        <th class="listfilter" data-field="Requested_Price_UoM__c">UoM</th>
                        <th class="numberfilter" data-field="TPI__c">TPI</th>
                        <th class="textfilter" data-field="Comments__c">Comments</th>
                        <th class="textfilter" data-field="Approval_Rejection_Comments__c">Approval Comments</th>
                        <th class="textfilter" data-field="Name">Transaction</th>
                        <th >Id</th>
                        <th >Inner Table</th>
                    </tr>
                    <tr>
                          <th class="Approval_Status">Status</th>
                          <th class="Approval_Level">Approval Level</th>
                          <th class="Approver">Approver</th>
                          <th class="Type">Type</th>
                          <th class="Sold_To">Sold To</th>
                          <th class="Ship_To">Ship To</th>
                          <th class="Material">Material</th>
                          <th class="Eff_Date">Eff Date (Y-M-D)</th>
                          <th class="Exp_Date">Exp Date (Y-M-D)</th>
                          <th class="Volume">Volume</th>
                          <th class="Requested_UoM">UoM</th>
                          <th class="Price">Price</th>
                          <th class="Requested_Price_UoM">UoM</th>
                          <th class="TPI">TPI</th>
                          <th class="Comments">Comments</th>
                          <th class="Approval_Rejection_Comments">Approval Comments</th>
                          <th class="Transaction">Transaction</th>
                          <th class="Id">Id</th>
                          <th class="Inner_Table">Inner Table</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
      </div>

</div>

<div id="rejectalternatediv" title="Rejected with Alternate" style="padding:10px;"> 

    
<div style="width:1500px;">
            <table id="rejectalternate" class="display viewtable">
                <thead>
                    <tr>
                        <th class="Open" rowspan="2">Open</th>
                        <th class="Select" rowspan="2">Select</th>
                        <th class="listfilter" data-field="Approval_Status__c">Status</th>
                        <th class="listfilter" data-field="Approval_Level__c">Approval Level</th>
                        <th class="textfilter" data-field="Approver__r.Name">Approver</th>
                        <th class="listfilter" data-field="Type__c">Type</th>
                        <th class="textfilter" data-field="SAP_SoldTo_Account__c">Sold To</th>
                        <th class="textfilter" data-field="SAP_ShipTo_Account__c">Ship To</th>
                        <th class="textfilter" data-field="Material__c">Material</th>
                        <th class="datefilter" data-field="Requested_Effective_Date__c">Eff Date (Y-M-D)</th>
                        <th class="datefilter" data-field="Requested_Expiration_Date__c">Exp Date (Y-M-D)</th>
                        <th class="numberfilter" data-field="Volume__c">Volume</th>
                        <th class="listfilter" data-field="Requested_UoM__c">UoM</th>
                        <th class="numberfilter" data-field="Price__c">Price</th>
                        <th class="listfilter" data-field="Requested_Price_UoM__c">UoM</th>
                        <th class="numberfilter" data-field="TPI__c">TPI</th>
                        <th class="textfilter" data-field="Comments__c">Comments</th>
                        <th class="textfilter" data-field="Approval_Rejection_Comments__c">Approval Comments</th>
                        <th class="textfilter" data-field="Name">Transaction</th>
                        <th >Id</th>
                        <th >Inner Table</th>
                    </tr>
                    <tr>
                          <th class="Approval_Status">Status</th>
                          <th class="Approval_Level">Approval Level</th>
                          <th class="Approver">Approver</th>
                          <th class="Type">Type</th>
                          <th class="Sold_To">Sold To</th>
                          <th class="Ship_To">Ship To</th>
                          <th class="Material">Material</th>
                          <th class="Eff_Date">Eff Date (Y-M-D)</th>
                          <th class="Exp_Date">Exp Date (Y-M-D)</th>
                          <th class="Volume">Volume</th>
                          <th class="Requested_UoM">UoM</th>
                          <th class="Price">Price</th>
                          <th class="Requested_Price_UoM">UoM</th>
                          <th class="TPI">TPI</th>
                          <th class="Comments">Comments</th>
                          <th class="Approval_Rejection_Comments">Approval Comments</th>
                          <th class="Transaction">Transaction</th>
                          <th class="Id">Id</th>
                          <th class="Inner_Table">Inner Table</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
      </div>
</div>
<div id="audittab" title="SFDC Price Audit" style="padding:10px;"> 
<div style="width:1500px;">
            <table id="audittable" class="display viewtable">
                <thead>
                    <tr>
                        <th class="Open" rowspan="2">Open</th>
                        <th class="Select" rowspan="2">Select</th>
                        <th class="listfilter" data-field="Approval_Status__c">Status</th>
                        <th class="listfilter" data-field="Approval_Level__c">Approval Level</th>
                        <th class="textfilter" data-field="Approver__r.Name">Approver</th>
                        <th class="listfilter" data-field="Type__c">Type</th>
                        <th class="textfilter" data-field="SAP_SoldTo_Account__c">Sold To</th>
                        <th class="textfilter" data-field="SAP_ShipTo_Account__c">Ship To</th>
                        <th class="textfilter" data-field="Material__c">Material</th>
                        <th class="datefilter" data-field="Requested_Effective_Date__c">Eff Date (Y-M-D)</th>
                        <th class="datefilter" data-field="Requested_Expiration_Date__c">Exp Date (Y-M-D)</th>
                        <th class="numberfilter" data-field="Volume__c">Volume</th>
                        <th class="listfilter" data-field="Requested_UoM__c">UoM</th>
                        <th class="numberfilter" data-field="Price__c">Price</th>
                        <th class="listfilter" data-field="Requested_Price_UoM__c">UoM</th>
                        <th class="numberfilter" data-field="TPI__c">TPI</th>
                        <th class="textfilter" data-field="Comments__c">Comments</th>
                        <th class="textfilter" data-field="Approval_Rejection_Comments__c">Approval Comments</th>
                        <th class="textfilter" data-field="Name">Transaction</th>
                        <th >Id</th>
                        <th >Inner Table</th>
                    </tr>
                    <tr>
                          <th class="Approval_Status">Status</th>
                          <th class="Approval_Level">Approval Level</th>
                          <th class="Approver">Approver</th>
                          <th class="Type">Type</th>
                          <th class="Sold_To">Sold To</th>
                          <th class="Ship_To">Ship To</th>
                          <th class="Material">Material</th>
                          <th class="Eff_Date">Start Date</th>
                          <th class="Exp_Date">Expiration Date</th>
                          <th class="Volume">Volume</th>
                          <th class="Requested_UoM">UoM</th>
                          <th class="Price">Price</th>
                          <th class="Requested_Price_UoM">UoM</th>
                          <th class="TPI">TPI</th>
                          <th class="Comments">Comments</th>
                          <th class="Approval_Rejection_Comments">Approval Comments</th>
                          <th class="Transaction">Transaction</th>
                          <th class="Id">Id</th>
                          <th class="Inner_Table">Inner Table</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
</div>
</div>

</div><!--End Tab Set-->
<div id="qq2" class="easyui-dialog" style="width:400px;height:10px;">
    <form id="rfqform">
    <br/>
    <center><span>
    <table>
    <tr><td><b>SAP Material</b></td>
    <td>
    <select class="singleselect" id="sap_material" style="width:225px;" data-name="RFQ Material" name="SAP_Material__c" data-label="Material_Name__c" data-value="SAP_Material__c" data-matfieldname="Name" multiple="multiple"></select> 
    </td>
    </tr>
    </table>
    </span></center>
    </form>
</div>

<div id="dd2" class="easyui-dialog"  style="width:400px;">
    <form id="amform">
    <br/>
    <center><span>
    <table>
    
    <tr><td><b>Account Owner</b></td><td><select class="amselect" style="width:225px;" data-label="Account_Owner_Name__c" name="Team_Employee_Ids__c" data-acctfieldname="Team_Employee_Ids__c" data-name="Owners" multiple="multiple" id="UserLookup"><apex:outputtext value="{!OwnerOptions}" escape="false"/></select></td></tr>
    
    <tr><td><b>Sales Orgs</b></td><td>
    
    <select class="amselect" id="morgs" style="width:225px;" data-label="AM_Account_Sales_Org__c" name="Account_Sales_Org_Code__c" data-acctfieldname="SAP_Sales_Org__c" data-name="Sales Orgs" multiple="multiple">
    <option value="1000">Nexeo Solutions, LLC</option>
    <option value="1700">Nexeo Sol. Can Corp.</option>
    <option value="1800">Nexeo Sol. Mex SRL</option>
    <option value="1031">Nexeo Sol. PR, LLC</option>
    </select>
    
    </td></tr>
    <tr><td><b>Divisions</b></td><td>
    
    <select class="amselect" id="mdivs" style="width:225px;" data-label="AM_Account_Division__c" name="Account_Division_Code__c" data-acctfieldname="SAP_DivisionCode__c" data-name="Divisions" multiple="multiple">
    <option value="31">Nexeo Chem</option>
    <option value="32">Nexeo Plas</option>
    
    </select>
    
    
    </td></tr>
    <tr><td><b>Account</b></td>
    <td id="acct_holder">
    <select class="singleselect" id="AM_add_acc" style="width:225px;" data-label="Account_Name__c" data-value="Account__c" name="Account__c" data-acctfieldname="id" data-name="Account" multiple="multiple"></select>
    </td> 
    </tr>
    
    
    <tr id ="dmat"><td><b>SAP Material</b></td>
    <td>
    <select class="singleselect" id="AM_add_material" style="width:225px;" data-name="SAP Material" name="SAP_Material__c" data-label="Material_Name__c" data-value="SAP_Material__c" data-matfieldname="Name" multiple="multiple"></select> 
    </td>
    </tr>

    <tr><td><b>Show All Materials</b></td>
    <td>
    <input class="chkbox" type="checkbox" id="AM_show_all_Mat" /> 
    </td>
    </tr>

    <tr><td><b>Prospect Material</b></td>
    <td>
    <input class="chkbox" type="checkbox" id="AM_add_Pros_Mat" /> 
    </td>
    </tr>
    </table>

    <div id = "dd21" class="dd21" style = "display:none">
    <table>
    <br/>    
    <center><span>
        <div id ="divsupp" class = "divsupp">
        <tr><td><b>Supplier</b></td><td><select style="width:225px;" class="suppselect" id="supplierlookup">
        </select></td></tr>  
        </div>
        <tr><td><b>Description</b></td>
        <td>
        <textarea id="Description" name="description" rows="1" cols="40"/>
        </td>
        </tr>
        
        <tr><td><b>Container for New Material</b></td>
        <td>
        <textarea id="containerfornewmaterial" name="containerfor" rows="1" cols="40"/>
         
        </td>
        </tr>
    
    </span></center>
    </table>   
    </div>
    
    
    </span></center>
    </form>


</div> 

<div id="dd" class="easyui-dialog" style="width:400px;">
        <form>
            <br />
            <center>
                <span><b>Comments</b><br />
                <textarea id="approvalcomments" name="appcomments" rows="12"
                        cols="150" />
                </span>
            </center>
        </form>
</div>

<div id="psr" class="easyui-dialog" style="width:400px;">
    <form id="psrform">
    <br/>
    <center><span>
    <table>
    <tr><td><b>Price Support Supplier</b></td><td>
    <input id="psrsupp" name="psrsupp" style="width:250px;"/>
    </td></tr> 
    </table>
    </span></center>
    </form>
</div>

</apex:page>